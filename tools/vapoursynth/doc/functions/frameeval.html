
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FrameEval &#8212; VapourSynth R51 documentation</title>
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FrameNum (Text)" href="framenum.html" />
    <link rel="prev" title="FlipVertical/FlipHorizontal" href="flip.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">VapourSynth R51 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="flip.html" title="FlipVertical/FlipHorizontal"
             accesskey="P">previous</a> |
          <a href="framenum.html" title="FrameNum (Text)"
             accesskey="N">next</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="frameeval">
<h1>FrameEval<a class="headerlink" href="#frameeval" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="std.FrameEval">
<code class="sig-prename descclassname">std.</code><code class="sig-name descname">FrameEval</code><span class="sig-paren">(</span><em class="sig-param">clip clip</em>, <em class="sig-param">func eval</em><span class="optional">[</span>, <em class="sig-param">clip[] prop_src</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#std.FrameEval" title="Permalink to this definition">¶</a></dt>
<dd><p>Allows an arbitrary function to be evaluated every frame. The function gets
the frame number, <em>n</em>, as input and should return a clip the output frame can
be requested from.</p>
<p>The <em>clip</em> argument is only used to get the output format from since there is
no reliable automatic way to deduce it.</p>
<p>When using the argument <em>prop_src</em> the function will also have an argument,
<em>f</em>, containing the current frames. This is mainly so frame properties can be
accessed and used to make decisions. Note that <em>f</em> will only be a list if
more than one <em>prop_src</em> clip is provided.</p>
<p>This function can be used to accomplish the same things as Animate,
ScriptClip and all the other conditional filters in Avisynth. Note that to
modify per frame properties you should use <em>ModifyFrame</em>.</p>
<p>How to animate a BlankClip to fade from white to black. This is the simplest
use case without using the <em>prop_src</em> argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">vapoursynth</span> <span class="k">as</span> <span class="nn">vs</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="n">core</span> <span class="o">=</span> <span class="n">vs</span><span class="o">.</span><span class="n">get_core</span><span class="p">()</span>
<span class="n">base_clip</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">BlankClip</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">YUV420P8</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">animator</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">clip</span><span class="p">):</span>
   <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">clip</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">BlankClip</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">YUV420P8</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">])</span>

<span class="n">animated_clip</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">FrameEval</span><span class="p">(</span><span class="n">base_clip</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">animator</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="n">base_clip</span><span class="p">))</span>
<span class="n">animated_clip</span><span class="o">.</span><span class="n">set_output</span><span class="p">()</span>
</pre></div>
</div>
<p>How to perform a simple per frame auto white balance. It shows how to access
calculated frame properties and use them for conditional filtering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">vapoursynth</span> <span class="k">as</span> <span class="nn">vs</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">GrayWorld1Adjust</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">clip</span><span class="p">,</span> <span class="n">core</span><span class="p">):</span>
   <span class="n">small_number</span> <span class="o">=</span> <span class="mf">0.000000001</span>
   <span class="n">red</span>   <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;PlaneStatsAverage&#39;</span><span class="p">]</span>
   <span class="n">green</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;PlaneStatsAverage&#39;</span><span class="p">]</span>
   <span class="n">blue</span>  <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;PlaneStatsAverage&#39;</span><span class="p">]</span>
   <span class="n">max_rgb</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">)</span>
   <span class="n">red_corr</span>   <span class="o">=</span> <span class="n">max_rgb</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">small_number</span><span class="p">)</span>
   <span class="n">green_corr</span> <span class="o">=</span> <span class="n">max_rgb</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">green</span><span class="p">,</span> <span class="n">small_number</span><span class="p">)</span>
   <span class="n">blue_corr</span>  <span class="o">=</span> <span class="n">max_rgb</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">small_number</span><span class="p">)</span>
   <span class="n">norm</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">red_corr</span><span class="o">*</span><span class="n">red_corr</span> <span class="o">+</span> <span class="n">green_corr</span><span class="o">*</span><span class="n">green_corr</span> <span class="o">+</span> <span class="n">blue_corr</span><span class="o">*</span><span class="n">blue_corr</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">small_number</span><span class="p">)</span>
   <span class="n">r_gain</span> <span class="o">=</span> <span class="n">red_corr</span><span class="o">/</span><span class="n">norm</span>
   <span class="n">g_gain</span> <span class="o">=</span> <span class="n">green_corr</span><span class="o">/</span><span class="n">norm</span>
   <span class="n">b_gain</span> <span class="o">=</span> <span class="n">blue_corr</span><span class="o">/</span><span class="n">norm</span>
   <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">r_gain</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; *&#39;</span><span class="p">,</span> <span class="s1">&#39;x &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">g_gain</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; *&#39;</span><span class="p">,</span> <span class="s1">&#39;x &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">b_gain</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; *&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">GrayWorld1</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="n">matrix_s</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
   <span class="n">core</span> <span class="o">=</span> <span class="n">vs</span><span class="o">.</span><span class="n">get_core</span><span class="p">()</span>
   <span class="n">rgb_clip</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">resize</span><span class="o">.</span><span class="n">Bilinear</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">RGB24</span><span class="p">)</span>
   <span class="n">r_avg</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">PlaneStats</span><span class="p">(</span><span class="n">rgb_clip</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">g_avg</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">PlaneStats</span><span class="p">(</span><span class="n">rgb_clip</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
   <span class="n">b_avg</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">PlaneStats</span><span class="p">(</span><span class="n">rgb_clip</span><span class="p">,</span> <span class="n">plane</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
   <span class="n">adjusted_clip</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">FrameEval</span><span class="p">(</span><span class="n">rgb_clip</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">GrayWorld1Adjust</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="n">rgb_clip</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="n">core</span><span class="p">),</span> <span class="n">prop_src</span><span class="o">=</span><span class="p">[</span><span class="n">r_avg</span><span class="p">,</span> <span class="n">g_avg</span><span class="p">,</span> <span class="n">b_avg</span><span class="p">])</span>
   <span class="k">return</span> <span class="n">core</span><span class="o">.</span><span class="n">resize</span><span class="o">.</span><span class="n">Bilinear</span><span class="p">(</span><span class="n">adjusted_clip</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">clip</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">matrix_s</span><span class="o">=</span><span class="n">matrix_s</span><span class="p">)</span>

<span class="n">core</span> <span class="o">=</span> <span class="n">vs</span><span class="o">.</span><span class="n">get_core</span><span class="p">()</span>
<span class="n">core</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">LoadPlugin</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;ffms2.dll&#39;</span><span class="p">)</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">ffms2</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">GrayWorld1</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">main</span><span class="o">.</span><span class="n">set_output</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          
          <h3>Table of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins and Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pythonreference.html">Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../avfs.html">AVFS (AV FileSystem)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications.html">Applications and Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../avisynthcomp.html">Avisynth functions and their VapourSynth equivalents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../includedplugins.html">Included Plugins</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../functions.html">Function Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="addborders.html">AddBorders</a></li>
<li class="toctree-l2"><a class="reference internal" href="assumefps.html">AssumeFPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="binarize.html">Binarize</a></li>
<li class="toctree-l2"><a class="reference internal" href="blankclip.html">BlankClip</a></li>
<li class="toctree-l2"><a class="reference internal" href="boxblur.html">BoxBlur</a></li>
<li class="toctree-l2"><a class="reference internal" href="cache.html">Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="clipinfo.html">ClipInfo (Text)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cliptoprop.html">ClipToProp</a></li>
<li class="toctree-l2"><a class="reference internal" href="convolution.html">Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="coreinfo.html">CoreInfo (Text)</a></li>
<li class="toctree-l2"><a class="reference internal" href="crop.html">Crop/CropAbs</a></li>
<li class="toctree-l2"><a class="reference internal" href="deflate_inflate.html">Deflate/Inflate</a></li>
<li class="toctree-l2"><a class="reference internal" href="deleteframes.html">DeleteFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="doubleweave.html">DoubleWeave</a></li>
<li class="toctree-l2"><a class="reference internal" href="duplicateframes.html">DuplicateFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="expr.html">Expr</a></li>
<li class="toctree-l2"><a class="reference internal" href="flip.html">FlipVertical/FlipHorizontal</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">FrameEval</a></li>
<li class="toctree-l2"><a class="reference internal" href="framenum.html">FrameNum (Text)</a></li>
<li class="toctree-l2"><a class="reference internal" href="frameprops.html">FrameProps (Text)</a></li>
<li class="toctree-l2"><a class="reference internal" href="freezeframes.html">FreezeFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="interleave.html">Interleave</a></li>
<li class="toctree-l2"><a class="reference internal" href="invert.html">Invert</a></li>
<li class="toctree-l2"><a class="reference internal" href="levels.html">Levels</a></li>
<li class="toctree-l2"><a class="reference internal" href="limiter.html">Limiter</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadplugin.html">LoadPlugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadpluginavs.html">LoadPlugin (Avisynth Compatibility)</a></li>
<li class="toctree-l2"><a class="reference internal" href="loop.html">Loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="lut.html">Lut</a></li>
<li class="toctree-l2"><a class="reference internal" href="lut2.html">Lut2</a></li>
<li class="toctree-l2"><a class="reference internal" href="makediff.html">MakeDiff</a></li>
<li class="toctree-l2"><a class="reference internal" href="maskedmerge.html">MaskedMerge</a></li>
<li class="toctree-l2"><a class="reference internal" href="median.html">Median</a></li>
<li class="toctree-l2"><a class="reference internal" href="merge.html">Merge</a></li>
<li class="toctree-l2"><a class="reference internal" href="mergediff.html">MergeDiff</a></li>
<li class="toctree-l2"><a class="reference internal" href="minimum_maximum.html">Minimum/Maximum</a></li>
<li class="toctree-l2"><a class="reference internal" href="modifyframe.html">ModifyFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="pemverifier.html">PEMVerifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="planestats.html">PlaneStats</a></li>
<li class="toctree-l2"><a class="reference internal" href="premultiply.html">PreMultiply</a></li>
<li class="toctree-l2"><a class="reference internal" href="prewitt_sobel.html">Prewitt/Sobel</a></li>
<li class="toctree-l2"><a class="reference internal" href="proptoclip.html">PropToClip</a></li>
<li class="toctree-l2"><a class="reference internal" href="resize.html">Resize</a></li>
<li class="toctree-l2"><a class="reference internal" href="reverse.html">Reverse</a></li>
<li class="toctree-l2"><a class="reference internal" href="selectevery.html">SelectEvery</a></li>
<li class="toctree-l2"><a class="reference internal" href="separatefields.html">SeparateFields</a></li>
<li class="toctree-l2"><a class="reference internal" href="setfieldbased.html">SetFieldBased (Experimental)</a></li>
<li class="toctree-l2"><a class="reference internal" href="setframeprop.html">SetFrameProp</a></li>
<li class="toctree-l2"><a class="reference internal" href="setmaxcpu.html">SetMaxCPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="shuffleplanes.html">ShufflePlanes</a></li>
<li class="toctree-l2"><a class="reference internal" href="splice.html">Splice</a></li>
<li class="toctree-l2"><a class="reference internal" href="stack.html">StackVertical/StackHorizontal</a></li>
<li class="toctree-l2"><a class="reference internal" href="text.html">Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="transpose.html">Transpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="trim.html">Trim</a></li>
<li class="toctree-l2"><a class="reference internal" href="turn180.html">Turn180</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vspipe.html">VSPipe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apireference.html">VapourSynth C API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </div>

        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="flip.html" title="FlipVertical/FlipHorizontal"
              >previous</a> |
            <a href="framenum.html" title="FrameNum (Text)"
              >next</a> |
            <a href="../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="../_sources/functions/frameeval.rst.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2020, Fredrik Mellbin.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>