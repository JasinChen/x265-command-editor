

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Layer &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Letterbox" href="letterbox.html" />
    <link rel="prev" title="KillAudio / KillVideo" href="killaudio.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="letterbox.html" title="Letterbox"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="killaudio.html" title="KillAudio / KillVideo"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Layer</a><ul>
<li><a class="reference internal" href="#id1">Layer</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mask">Mask</a></li>
<li><a class="reference internal" href="#resetmask">ResetMask</a></li>
<li><a class="reference internal" href="#colorkeymask">ColorKeyMask</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="killaudio.html"
                        title="previous chapter">KillAudio / KillVideo</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="letterbox.html"
                        title="next chapter">Letterbox</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/corefilters/layer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="layer">
<h1><a class="toc-backref" href="#id2">Layer</a><a class="headerlink" href="#layer" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#layer" id="id2">Layer</a><ul>
<li><a class="reference internal" href="#id1" id="id3">Layer</a><ul>
<li><a class="reference internal" href="#examples" id="id4">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mask" id="id5">Mask</a></li>
<li><a class="reference internal" href="#resetmask" id="id6">ResetMask</a></li>
<li><a class="reference internal" href="#colorkeymask" id="id7">ColorKeyMask</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id3">Layer</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>This filter works with <em>yuy2, rgb32</em></p>
<p><code class="docutils literal notranslate"><span class="pre">Layer</span></code> (base_clip, overlay_clip, string “op”, int “level”, int “x”, int
“y”, int “threshold”, bool “use_chroma”)</p>
<p>This filter can overlay two clips of different sizes (but with the same color
format) using different operation modes.
For pixel-wise transparency information the 4th color channel of RGB32 (A- or
alpha-channel) is used as a mask.</p>
<p><em>Base_clip</em>: the underlying clip which determines the size and all other video
and audio properties of the result.</p>
<p><em>Overlay_clip</em>: the clip which is merged onto clip. This clip can contain an
alpha layer.</p>
<p><em>op</em>: the performed merge operation, which can be: “add”, “subtract”,
“lighten”, “darken”, “fast”, “mul”</p>
<p><em>level</em>: 0-257, the strength of the performed operation. 0: the base_clip is
returned unchanged, 257 (256 for YUY2): the maximal strength is used</p>
<p><em>x</em>, <em>y</em>: offset position of the overlay_clip</p>
<p><em>threshold</em>: only implemented for “lighten” and “darken”</p>
<p><em>use_chroma</em>: use chroma of the overlay_clip, default=true. When false only
luma is used.</p>
<p>There are some differences in the behaviour and the allowed parameter
depending on the color format and the operation, here are the details:</p>
<ul class="simple">
<li>There is no mask (alpha-channel) in YUY2, so the alpha-channel is
assumed to be fully opaque everywhere.</li>
<li>in RGB32 the alpha-channel of the overlay_clip is multiplied with
level, so the resulting alpha = (alpha_mask * level + 1) / 256. This
means for full strength of operation alpha has to be 255 and level has to
be 257.</li>
</ul>
<p>These operators behave equally for RGB32 or YUY2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;fast&quot;</span><span class="p">:</span> <span class="o">*</span><span class="n">use_chroma</span><span class="o">*</span> <span class="n">must</span> <span class="n">be</span> <span class="n">TRUE</span><span class="p">,</span> <span class="o">*</span><span class="n">level</span><span class="o">*</span> <span class="ow">and</span> <span class="o">*</span><span class="n">threshold</span><span class="o">*</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">used</span><span class="o">.</span>
        <span class="n">The</span> <span class="n">result</span> <span class="ow">is</span> <span class="n">simply</span> <span class="n">the</span> <span class="n">average</span> <span class="n">of</span> <span class="o">*</span><span class="n">base_clip</span><span class="o">*</span> <span class="ow">and</span>
        <span class="o">*</span><span class="n">overlay_clip</span><span class="o">*.</span>

<span class="s2">&quot;add&quot;</span><span class="p">:</span>  <span class="o">*</span><span class="n">threshold</span><span class="o">*</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">used</span><span class="o">.</span> <span class="n">The</span> <span class="n">difference</span> <span class="n">between</span> <span class="n">base_clip</span> <span class="ow">and</span>
        <span class="n">overlay_clip</span> <span class="ow">is</span> <span class="n">multiplied</span> <span class="k">with</span> <span class="n">alpha</span> <span class="ow">and</span> <span class="n">added</span> <span class="n">to</span>
        <span class="n">the</span> <span class="n">base_clip</span><span class="o">.</span>
          <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">only</span> <span class="n">base_clip</span> <span class="n">visible</span><span class="p">,</span>
          <span class="n">alpha</span><span class="o">=</span><span class="mi">128</span> <span class="o">-&gt;</span> <span class="n">base</span> <span class="ow">and</span> <span class="n">overlay</span> <span class="n">equally</span> <span class="n">blended</span><span class="p">,</span>
          <span class="n">alpha</span><span class="o">=</span><span class="mi">255</span> <span class="o">-&gt;</span> <span class="n">only</span> <span class="n">overlay</span> <span class="n">visible</span><span class="o">.</span>
    <span class="n">Formula</span> <span class="n">used</span> <span class="p">:</span><span class="o">-</span>
      <span class="n">RGB32</span> <span class="p">::</span> <span class="n">base</span> <span class="o">+=</span> <span class="p">((</span><span class="n">overlay</span><span class="o">-</span><span class="n">base</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">level</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span>
      <span class="n">YUY2</span>  <span class="p">::</span> <span class="n">base</span> <span class="o">+=</span> <span class="p">((</span><span class="n">overlay</span><span class="o">-</span><span class="n">base</span><span class="p">)</span><span class="o">*</span><span class="n">level</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span>

<span class="s2">&quot;subtract&quot;</span><span class="p">:</span> <span class="n">the</span> <span class="n">same</span> <span class="k">as</span> <span class="n">add</span><span class="p">,</span> <span class="n">but</span> <span class="n">the</span> <span class="n">overlay_clip</span> <span class="ow">is</span> <span class="n">inverted</span> <span class="n">before</span><span class="o">.</span>
</pre></div>
</div>
<p>These operators seem to work correctly only in YUY2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;mul&quot;</span><span class="p">:</span> <span class="o">*</span><span class="n">threshold</span><span class="o">*</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">used</span><span class="o">.</span> <span class="n">The</span> <span class="n">base_clip</span> <span class="ow">is</span> <span class="n">colored</span>
       <span class="k">as</span> <span class="n">overlay_clip</span><span class="p">,</span> <span class="n">so</span> <span class="o">*</span><span class="n">use_chroma</span><span class="o">*</span> <span class="n">should</span> <span class="n">be</span> <span class="n">TRUE</span><span class="o">.</span>
       <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">only</span> <span class="n">base_clip</span> <span class="n">visible</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">255</span> <span class="o">-&gt;</span> <span class="n">approx</span><span class="o">.</span>
       <span class="n">the</span> <span class="n">same</span> <span class="n">Luminance</span> <span class="k">as</span> <span class="n">Base</span> <span class="n">but</span> <span class="k">with</span> <span class="n">the</span> <span class="n">colors</span> <span class="n">of</span>
       <span class="n">Overlay</span>

<span class="s2">&quot;lighten&quot;</span><span class="p">:</span> <span class="o">*</span><span class="n">use_chroma</span><span class="o">*</span> <span class="n">must</span> <span class="n">be</span> <span class="n">TRUE</span><span class="o">.</span> <span class="n">Performs</span> <span class="n">the</span> <span class="n">same</span> <span class="n">operation</span>
           <span class="k">as</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">but</span> <span class="n">only</span> <span class="n">when</span> <span class="n">the</span> <span class="n">result</span> <span class="ow">is</span> <span class="n">BRIGHTER</span>
           <span class="n">than</span> <span class="n">the</span> <span class="n">base</span> <span class="n">the</span> <span class="n">new</span> <span class="n">values</span> <span class="n">are</span> <span class="n">used</span><span class="o">.</span> <span class="n">With</span> <span class="n">a</span> <span class="n">higher</span>
           <span class="o">*</span><span class="n">threshold</span><span class="o">*</span> <span class="n">the</span> <span class="n">operation</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">likely</span><span class="p">,</span> <span class="n">so</span> <span class="k">with</span>
           <span class="o">*</span><span class="n">threshold</span><span class="o">*=</span><span class="mi">255</span> <span class="n">it</span><span class="s1">&#39;s the same as &quot;add&quot;, with threshold=0</span>
           <span class="n">the</span> <span class="n">base_clip</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">likely</span> <span class="n">passed</span> <span class="n">unchanged</span><span class="p">,</span> <span class="n">depending</span>
           <span class="n">on</span> <span class="n">the</span> <span class="n">difference</span> <span class="n">between</span> <span class="n">base_clip</span> <span class="ow">and</span> <span class="n">overlay_clip</span><span class="o">.</span>

<span class="s2">&quot;darken&quot;</span><span class="p">:</span> <span class="n">the</span> <span class="n">same</span> <span class="k">as</span> <span class="s2">&quot;lighten&quot;</span><span class="p">,</span> <span class="n">but</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">performed</span> <span class="n">only</span>
          <span class="n">when</span> <span class="n">the</span> <span class="n">result</span> <span class="ow">is</span> <span class="n">DARKER</span> <span class="n">than</span> <span class="n">the</span> <span class="n">base</span><span class="o">.</span>
</pre></div>
</div>
<p>Also see <a class="reference internal" href="../syntax/syntax.html#multiclip"><span class="std std-ref">here</span></a> for the resulting clip properties.</p>
<div class="section" id="examples">
<h3><a class="toc-backref" href="#id4">Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>This can be used to combine two captures of different broadcasts for reducing
noise. A discussion of this idea can be found <a class="reference external" href="http://forum.doom9.org/showthread.php?s=&amp;threadid=28438">in this thread</a>. A sample script (of
course you have to ensure that the frames of the two clips match exactly –
use <a class="reference internal" href="deleteframe.html"><span class="doc">DeleteFrame</span></a> if necessary):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clip1</span> <span class="o">=</span> <span class="n">AviSource</span><span class="p">(</span><span class="s2">&quot;F:\shakira-underneath_your_clothes.avi&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ConvertToYUY2</span>
<span class="n">clip2</span> <span class="o">=</span> <span class="n">AviSource</span><span class="p">(</span><span class="s2">&quot;F:\shakira-</span>
<span class="n">underneath_your_clothes2</span><span class="o">.</span><span class="n">avi</span><span class="s2">&quot;).ConvertToYUY2</span>
<span class="k">return</span> <span class="n">Layer</span><span class="p">(</span><span class="n">clip1</span><span class="p">,</span> <span class="n">clip2</span><span class="p">,</span> <span class="s2">&quot;fast&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mask">
<h2><a class="toc-backref" href="#id5">Mask</a><a class="headerlink" href="#mask" title="Permalink to this headline">¶</a></h2>
<p>This filter works with <em>rgb32</em></p>
<p><code class="docutils literal notranslate"><span class="pre">Mask</span></code> (clip, mask_clip)</p>
<p>Applies a defined alpha-mask to clip, for use with <code class="docutils literal notranslate"><span class="pre">Layer</span></code>, by converting
mask_clip to greyscale and using that for the mask (the alpha-channel) of
RGB32. In this channel “black” means completely transparent and white means
completely opaque.</p>
<p>For those of you who familiar with Photoshop masks, the concept is the same.
In fact you can create a black and white photo in Photoshop, load it in your
script and use it as a mask.</p>
<p>Here is an example; ss.jpg is derived from a snapshot from a video clip,
which served as a guideline to create the mask just using Paint. We use
Imagesource to load the image in the script and Mask to apply it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bg</span> <span class="o">=</span> <span class="n">AviSource</span><span class="p">(</span><span class="s2">&quot;01gray.avi&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ConvertToRGB32</span><span class="p">()</span>       <span class="c1"># here is the background clip</span>
<span class="n">mk</span> <span class="o">=</span> <span class="n">Imagesource</span><span class="p">(</span><span class="s2">&quot;ss.jpg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ConvertToRGB32</span><span class="p">()</span>         <span class="c1"># load the image</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">AviSource</span><span class="p">(</span><span class="s2">&quot;k3.avi&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ConvertToRGB32</span><span class="p">()</span><span class="o">.</span><span class="n">Mask</span><span class="p">(</span><span class="n">mk</span><span class="p">)</span> <span class="c1"># load the top layer clip and apply the mask to it</span>
<span class="n">Layer</span><span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>                                      <span class="c1"># layer the background and the top layer clip with the mask</span>
</pre></div>
</div>
</div>
<div class="section" id="resetmask">
<h2><a class="toc-backref" href="#id6">ResetMask</a><a class="headerlink" href="#resetmask" title="Permalink to this headline">¶</a></h2>
<p>This filter works with <em>rgb32</em></p>
<p><code class="docutils literal notranslate"><span class="pre">ResetMask</span></code> (clip)</p>
<p>Applies an “all-opaque” (that is white) alpha-mask to <em>clip</em>, for use with
<code class="docutils literal notranslate"><span class="pre">Layer</span></code>.</p>
<p>The alpha-channel of a RGB32-clip is not always well-defined (depending on
the source), this filter is the faster way to apply an all white mask:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clip</span> <span class="o">=</span> <span class="n">ResetMask</span><span class="p">(</span><span class="n">clip</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="colorkeymask">
<h2><a class="toc-backref" href="#id7">ColorKeyMask</a><a class="headerlink" href="#colorkeymask" title="Permalink to this headline">¶</a></h2>
<p>This filter works with <em>rgb32</em></p>
<p><code class="docutils literal notranslate"><span class="pre">ColorKeyMask</span></code> (clip, int color[, int tolB, int tolG, int tolR])</p>
<p>Clears pixels in the alpha-channel by comparing the color (default black).
Each pixel with a color differing less than (tolB, tolR, tolG) (default 10)
is set to transparent (that is black), otherwise it is left unchanged i.e. It
is NOT set to opaque (that it is not set to white, that’s why you might need
ResetMask before applying this filter), this allows a aggregate mask to be
constructed with multiple calls. When tolR or tolG are not set, they use the
value from tolB (which reflects the old behaviour). Normally you start with a
ResetMask, then chain a few calls to ColorKeyMask to cause transparent holes
where each color of interest occurs. <strong>See :doc:`Overlay &lt;overlay&gt;` for examples.</strong></p>
<p>For AviSynth versions older than v2.58, there were no separate tolerance
levels for blue, green and red. There was only one tolerance level called
tolerance and was used for blue, green and red simultaneously.</p>
<p>$Date: 2012/03/18 15:25:39 $</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="letterbox.html" title="Letterbox"
             >next</a> |</li>
        <li class="right" >
          <a href="killaudio.html" title="KillAudio / KillVideo"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>