

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>GeneralConvolution &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Crop / CropBottom" href="crop.html" />
    <link rel="prev" title="ConvertToMono" href="converttomono.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="crop.html" title="Crop / CropBottom"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="converttomono.html" title="ConvertToMono"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">GeneralConvolution</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="converttomono.html"
                        title="previous chapter">ConvertToMono</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="crop.html"
                        title="next chapter">Crop / CropBottom</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/corefilters/convolution.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="generalconvolution">
<h1>GeneralConvolution<a class="headerlink" href="#generalconvolution" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">GeneralConvolution</span></code> (clip, int “bias”, string “matrix”, float “divisor”,
bool “auto”)</p>
<p>This filter performs a matrix convolution on a RGB32 clip.</p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameters</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>clip</td>
<td>RGB32 clip</td>
</tr>
<tr class="row-odd"><td>bias (default 0)</td>
<td>additive bias to adjust the
total output intensity</td>
</tr>
<tr class="row-even"><td>matrix (default “0 0 0 0 1 0 0 0 0”)</td>
<td>can be a 3x3 or 5x5 matrix
with 9 or 25 integer numbers
between -256 and 256</td>
</tr>
<tr class="row-odd"><td>divisor (default 1.0)</td>
<td>divides the output of the
convolution (calculated before
adding bias)</td>
</tr>
<tr class="row-even"><td>auto (default true)</td>
<td>Enables the auto scaling
functionality. This divides the
result by the sum of the elements
of the matrix. The value of divisor
is applied in addition to this auto
scaling factor. If the sum of
elements is zero, auto is disabled</td>
</tr>
</tbody>
</table>
<p>The divisor is usually the sum of the elements of the matrix. But when the
sum is zero, you must use divisor and the bias setting to correct the pixel
values. The bias could be useful if the pixel values are negative due to the
convolution. After adding a bias, the pixels are just clipped to zero (and
255 if they are larger than 255).</p>
<p>Around the borders the edge pixels are simply repeated to service the matrix.</p>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Blur:</span>

<span class="n">GeneralConvolution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;</span>
   <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span>
   <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span>
   <span class="mi">10</span> <span class="mi">10</span> <span class="mi">16</span> <span class="mi">10</span> <span class="mi">10</span>
   <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span>
   <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="s2">&quot;, 256, False)</span>

<span class="c1"># Horizontal (Sobel) edge detection:</span>

<span class="n">GeneralConvolution</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="s2">&quot;</span>
    <span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">1</span>
    <span class="mi">0</span>  <span class="mi">0</span>  <span class="mi">0</span>
   <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">2</span> <span class="o">-</span><span class="mi">1</span> <span class="s2">&quot;, 8)</span>

<span class="c1"># Vertical (Sobel) Edge Detection:</span>

<span class="n">GeneralConvolution</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="s2">&quot;</span>
   <span class="mi">1</span>  <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span>
   <span class="mi">2</span>  <span class="mi">0</span> <span class="o">-</span><span class="mi">2</span>
   <span class="mi">1</span>  <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span> <span class="s2">&quot;, 8)</span>

<span class="c1"># Displacement (simply move the position</span>
<span class="c1"># of the &quot;1&quot; for left, right, up, down)</span>

<span class="n">GeneralConvolution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;</span>
   <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span>
   <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span>
   <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="s2">&quot;)</span>

<span class="c1"># Displacement by half pixel up (auto scaling):</span>

<span class="n">GeneralConvolution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;</span>
   <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span>
   <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span>
   <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="s2">&quot;)</span>

<span class="c1"># Displacement by half pixel right (manual scaling):</span>

<span class="n">GeneralConvolution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;</span>
   <span class="mi">0</span>   <span class="mi">0</span>   <span class="mi">0</span>
   <span class="mi">0</span> <span class="mi">128</span> <span class="mi">128</span>
   <span class="mi">0</span>   <span class="mi">0</span>   <span class="mi">0</span> <span class="s2">&quot;, 256, False)</span>

<span class="c1"># Sharpness filter:</span>

<span class="n">GeneralConvolution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;</span>
   <span class="mi">0</span>   <span class="o">-</span><span class="mi">1</span>   <span class="mi">0</span>
  <span class="o">-</span><span class="mi">1</span>    <span class="mi">5</span>  <span class="o">-</span><span class="mi">1</span>
   <span class="mi">0</span>   <span class="o">-</span><span class="mi">1</span>   <span class="mi">0</span> <span class="s2">&quot;, 1, True)</span>

<span class="n">In</span> <span class="n">this</span> <span class="n">case</span><span class="p">,</span> <span class="n">the</span> <span class="n">new</span> <span class="n">pixel</span> <span class="n">values</span> <span class="n">y</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="n">are</span> <span class="n">given</span> <span class="n">by</span>
<span class="n">y</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
         <span class="o">-</span> <span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">5</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mi">0</span> <span class="p">::</span><span class="c1"># Slight blur</span>
         <span class="nb">filter</span> <span class="k">with</span> <span class="n">black</span> <span class="n">level</span> <span class="n">clipping</span> <span class="ow">and</span> <span class="mi">25</span><span class="o">%</span> <span class="n">brightening</span><span class="p">:</span>

<span class="n">GeneralConvolution</span><span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="s2">&quot;</span>
   <span class="mi">0</span>   <span class="mi">12</span>   <span class="mi">0</span>
  <span class="mi">12</span>  <span class="mi">256</span>  <span class="mi">12</span>
   <span class="mi">0</span>   <span class="mi">12</span>   <span class="mi">0</span> <span class="s2">&quot;, 0.75 ,True)</span>

<span class="n">In</span> <span class="n">this</span> <span class="n">case</span><span class="p">,</span> <span class="n">the</span> <span class="n">new</span> <span class="n">pixel</span> <span class="n">values</span> <span class="n">y</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="n">are</span> <span class="n">given</span> <span class="n">by</span>
<span class="n">y</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">12</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">256</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
         <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">12</span><span class="o">+</span><span class="mi">12</span><span class="o">+</span><span class="mi">256</span><span class="o">+</span><span class="mi">12</span><span class="o">+</span><span class="mi">12</span><span class="p">)</span><span class="o">/</span><span class="mf">0.75</span> <span class="o">-</span> <span class="mi">16</span>
</pre></div>
</div>
<p>Some other examples can be found <a class="reference external" href="http://www.gamedev.net/reference/programming/features/imageproc/page2.asp">here</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Changelog</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>v2
v2.55</td>
<td>Initial Release
added divisor, auto</td>
</tr>
</tbody>
</table>
<p>$Date: 2010/08/15 14:18:26 $</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="crop.html" title="Crop / CropBottom"
             >next</a> |</li>
        <li class="right" >
          <a href="converttomono.html" title="ConvertToMono"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>