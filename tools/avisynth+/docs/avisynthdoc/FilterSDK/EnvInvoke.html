

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>EnvInvoke &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="EnvSaveString" href="EnvSaveString.html" />
    <link rel="prev" title="DualPlugins" href="DualPlugins.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="EnvSaveString.html" title="EnvSaveString"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="DualPlugins.html" title="DualPlugins"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">EnvInvoke</a><ul>
<li><a class="reference internal" href="#caching-frames-from-invoked-filters">Caching frames from Invoked filters</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="DualPlugins.html"
                        title="previous chapter">DualPlugins</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="EnvSaveString.html"
                        title="next chapter">EnvSaveString</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/FilterSDK/EnvInvoke.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="envinvoke">
<h1>EnvInvoke<a class="headerlink" href="#envinvoke" title="Permalink to this headline">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">virtual</span> <span class="n">AVSValue</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">name</span><span class="p">,</span> <span class="n">const</span> <span class="n">AVSValue</span> <span class="n">args</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span><span class="o">**</span> <span class="n">arg_names</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>You can use this to call a script function. There are many script functions
which can be useful from other filters; for example, the Bob filter uses
SeparateFields, and several source filters use UnalignedSplice. Some
functions, like Weave, are implemented entirely in terms of other functions.</p>
<p>If you’re calling a function taking exactly one argument, you can simply pass
it in the args parameter; Invoke will convert it into an array for you. In
order to call a function taking multiple arguments, you will need to create
the array yourself; it can be done like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AVSValue</span> <span class="n">args</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">clip</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">,</span> <span class="s2">&quot;my hovercraft is full of eels&quot;</span> <span class="p">};</span>
  <span class="n">env</span><span class="o">-&gt;</span><span class="n">Invoke</span><span class="p">(</span><span class="s2">&quot;Frob&quot;</span><span class="p">,</span> <span class="n">AVSValue</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
</pre></div>
</div>
<p>In this case Frob would need to have a parameter-type string like “cibfs” or
“cfbfs” or “cf.*”.</p>
<p>The arg_names parameter can be used to specify named arguments. Named
arguments can also be given positionally, if you prefer.</p>
<p>Invoke throws <code class="docutils literal notranslate"><span class="pre">IScriptEnvironment</span> <span class="pre">::</span> <span class="pre">NotFound</span></code> if it can’t find a matching
function prototype. You should be prepared to catch this unless you know that
the function exists and will accept the given arguments.</p>
<p>A few examples (grabbed from MipSmooth - it uses invoke a lot):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>try {
        AVSValue args[1] = { child };
        PClip reduced =
        env-&gt;Invoke(&quot;Reduceby2&quot;,AVSValue(args,1)).AsClip();
    } catch (IScriptEnvironment::NotFound) {
        env-&gt;ThrowError(&quot;MyFilterError: Whoa! Could not Invoke
        reduce!&quot;);
    }
</pre></div>
</div>
<p>This piece of code calls <em>ReduceBy2(child)</em>, and places the result in
<em>reduced</em>. If you need the videoinfo (for whatever reason), you can get by
requesting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VideoInfo</span> <span class="n">reduced_vi</span> <span class="o">=</span> <span class="n">reduced</span><span class="o">-&gt;</span><span class="n">GetVideoInfo</span><span class="p">();</span>
</pre></div>
</div>
<p>Another example (using a resizer)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>try {
        upsizerString=&quot;LanczosResize&quot;;
        AVSValue up_args[3] = { child, 384, 288 };
        PClip resized = env-&gt;Invoke(upsizerString,
        AVSValue(up_args,3)).AsClip();
    } catch (IScriptEnvironment::NotFound) {
        env-&gt;ThrowError(&quot;MyFilterError: Whoa! Could not Invoke
        the resizer!&quot;);
    }
</pre></div>
</div>
<p>In general, avoid invoking “Invoke” as much as possible. If it can be
avoided, try not to do it every frame, but do it in the constructor, if the
filter parameters doesn’t change. Invoking on every frame usually brings down
the speed of the filter to a fraction of a static filter, at it has to be
created and destroyed every frame.</p>
<div class="section" id="caching-frames-from-invoked-filters">
<h2>Caching frames from Invoked filters<a class="headerlink" href="#caching-frames-from-invoked-filters" title="Permalink to this headline">¶</a></h2>
<p>env-&gt;Invoke does <strong>not</strong> automatically insert a cache after the filter you
invoke. That means that each time you request a frame (using GetFrame) from
the invoked filter the filter will need to generate the frame. This is not a
problem if your filter only requests one unique frame per frame it generates.</p>
<p>If your filter however needs both the previous, the current and the next
frame to generate the current frame, the invoked filter will get called three
(3) times per frame you return.</p>
<p>It really only needs to be invoked to create the next frame (as the current
and previous frame can be reused).</p>
<p>To avoid this scenario, the internal cache filter has been exposed from
AviSynth 2.5.3, and is available to plugin writers.</p>
<p>To insert a invoke the cache, invoke it like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">We</span> <span class="n">are</span> <span class="n">assuming</span> <span class="n">your</span> <span class="n">invoked</span> <span class="nb">filter</span> <span class="n">to</span> <span class="n">be</span> <span class="n">placed</span> <span class="ow">in</span> <span class="s2">&quot;PClip resized&quot;</span> <span class="k">as</span> <span class="n">above</span><span class="o">.</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="n">AVSValue</span> <span class="n">up_args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">resized</span> <span class="p">};</span>
        <span class="n">resized</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">Invoke</span><span class="p">(</span><span class="s2">&quot;InternalCache&quot;</span><span class="p">,</span>
        <span class="n">AVSValue</span><span class="p">(</span><span class="n">up_args</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">AsClip</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">IScriptEnvironment</span><span class="p">::</span><span class="n">NotFound</span><span class="p">)</span> <span class="p">{</span>
       <span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">AviSynth</span> <span class="n">version</span> <span class="ow">is</span> <span class="n">too</span> <span class="n">low</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">internal</span>
       <span class="n">cache</span> <span class="n">isn</span><span class="s1">&#39;t exposed, we just ignore this situation.</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>You can also set cache hints. In the scenario above, where we need one frame
prior and one frame after the current one, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resized</span><span class="o">-&gt;</span><span class="n">SetCacheHints</span><span class="p">(</span><span class="n">CACHE_RANGE</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Update: since AviSynth 2.5.6 the cache range parameter is considered as a
‘diameter’=1+radius*2. It equal to 3 in the scenario above (previous, current
and next frame), so use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resized</span><span class="o">-&gt;</span><span class="n">SetCacheHints</span><span class="p">(</span><span class="n">CACHE_RANGE</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
<hr class="docutils" />
<p>Back to <a class="reference internal" href="FilterSDK.html"><span class="doc">AviSynth FilterSDK</span></a></p>
<p>$Date: 2014/10/27 22:04:54 $</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="EnvSaveString.html" title="EnvSaveString"
             >next</a> |</li>
        <li class="right" >
          <a href="DualPlugins.html" title="DualPlugins"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>