

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CompilingAviSynthPlugins &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="C++ API" href="Cplusplus_api.html" />
    <link rel="prev" title="Colorspace properties" href="ColorspaceProperties.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Cplusplus_api.html" title="C++ API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ColorspaceProperties.html" title="Colorspace properties"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CompilingAviSynthPlugins</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-6-0">Compiling AviSynth Plugins step by step instructions (for MS VC++ 6.0)</a></li>
<li><a class="reference internal" href="#how-to-debug-avisynth-plugins">How to debug AviSynth plugins</a><ul>
<li><a class="reference internal" href="#how-to-debug-avisynth-plugins-the-short-way">How to debug AviSynth plugins (the short way)</a></li>
<li><a class="reference internal" href="#how-to-debug-avisynth-plugins-for-ms-vc-6-0">How to debug Avisynth plugins (for MS VC++ 6.0)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debug-info-from-map-file">Debug info from MAP file</a></li>
<li><a class="reference internal" href="#compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-2005-express-edition">Compiling AviSynth Plugins step by step instructions (for MS VC++ 2005 Express Edition)</a><ul>
<li><a class="reference internal" href="#setup-vc-2005-express-edition-environment">Setup VC++ 2005 Express Edition environment</a></li>
<li><a class="reference internal" href="#how-to-compile-existant-old-ms-vc-6-0-plugin-with-ms-vc-2005">How to compile existant (old MS VC 6.0) plugin with MS VC++ 2005</a></li>
<li><a class="reference internal" href="#how-to-create-new-plugin-from-scratch-with-ms-vc-2005">How to create new plugin from scratch with MS VC++ 2005</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-2008-professional-edition">Compiling AviSynth Plugins step by step instructions (for MS VC++ 2008 Professional Edition)</a></li>
<li><a class="reference internal" href="#compiling-avisynth-plugins-or-console-applications-step-by-step-instructions-for-ms-vc-2010-express-and-professional-edition">Compiling AviSynth Plugins or Console Applications step by step instructions (for MS VC++ 2010 Express and Professional Edition)</a><ul>
<li><a class="reference internal" href="#creating-a-new-project">Creating a new project</a></li>
<li><a class="reference internal" href="#general-settings">General settings</a></li>
<li><a class="reference internal" href="#building-the-plugin-or-console-application">Building the plugin or console application</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ColorspaceProperties.html"
                        title="previous chapter">Colorspace properties</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Cplusplus_api.html"
                        title="next chapter">C++ API</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/FilterSDK/CompilingAvisynthPlugins.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="compilingavisynthplugins">
<h1><a class="toc-backref" href="#id18">CompilingAviSynthPlugins</a><a class="headerlink" href="#compilingavisynthplugins" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#compilingavisynthplugins" id="id18">CompilingAviSynthPlugins</a><ul>
<li><a class="reference internal" href="#introduction" id="id19">Introduction</a></li>
<li><a class="reference internal" href="#compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-6-0" id="id20">Compiling AviSynth Plugins step by step instructions (for MS VC++ 6.0)</a></li>
<li><a class="reference internal" href="#how-to-debug-avisynth-plugins" id="id21">How to debug AviSynth plugins</a><ul>
<li><a class="reference internal" href="#how-to-debug-avisynth-plugins-the-short-way" id="id22">How to debug AviSynth plugins (the short way)</a></li>
<li><a class="reference internal" href="#how-to-debug-avisynth-plugins-for-ms-vc-6-0" id="id23">How to debug Avisynth plugins (for MS VC++ 6.0)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debug-info-from-map-file" id="id24">Debug info from MAP file</a></li>
<li><a class="reference internal" href="#compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-2005-express-edition" id="id25">Compiling AviSynth Plugins step by step instructions (for MS VC++ 2005 Express Edition)</a><ul>
<li><a class="reference internal" href="#setup-vc-2005-express-edition-environment" id="id26">Setup VC++ 2005 Express Edition environment</a></li>
<li><a class="reference internal" href="#how-to-compile-existant-old-ms-vc-6-0-plugin-with-ms-vc-2005" id="id27">How to compile existant (old MS VC 6.0) plugin with MS VC++ 2005</a></li>
<li><a class="reference internal" href="#how-to-create-new-plugin-from-scratch-with-ms-vc-2005" id="id28">How to create new plugin from scratch with MS VC++ 2005</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-2008-professional-edition" id="id29">Compiling AviSynth Plugins step by step instructions (for MS VC++ 2008 Professional Edition)</a></li>
<li><a class="reference internal" href="#compiling-avisynth-plugins-or-console-applications-step-by-step-instructions-for-ms-vc-2010-express-and-professional-edition" id="id30">Compiling AviSynth Plugins or Console Applications step by step instructions (for MS VC++ 2010 Express and Professional Edition)</a><ul>
<li><a class="reference internal" href="#creating-a-new-project" id="id31">Creating a new project</a></li>
<li><a class="reference internal" href="#general-settings" id="id32">General settings</a></li>
<li><a class="reference internal" href="#building-the-plugin-or-console-application" id="id33">Building the plugin or console application</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<span id="id1"></span><h2><a class="toc-backref" href="#id19">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The Avisynth API is a C++ API, but that doesn’t mean that you can use
every C++ compiler to compile your plugin. Unfortunately compilers have
different ideas about what the C++ ABI should look like. In practice,
this means that if you want things to work 100% as expected, you must
compile your plugin with the same compiler that was used to compile
AviSynth. That’s MSVC 6.0 for official builds. Later versions of MSVC
will kinda sorta work, as will ICL (up to ICL10.1), but there are
caveats (for example, you must never allow any C++ exceptions to escape
your plugin ever - use ThrowError() instead - and you must always make
sure memory allocated by AviSynth is freed by AviSynth itself and not
by your plugin). So unfortunately it matters what C++ compiler will be
used to compile a plugin.</p>
<p>An application binary interface (<a class="reference external" href="http://en.wikipedia.org/wiki/Application_binary_interface">ABI</a>) specifies how software
components should interact with each other at the binary level (in this
case AviSynth and a plugin). ABIs cover details such as the sizes,
layout, and alignment of data types, the calling convention of
functions’ arguments that are passed and returned. It standardizes
details such as the <a class="reference external" href="http://en.wikipedia.org/wiki/Name_mangling#Name_mangling_in_C.2B.2B">C++ name mangling</a> and exception propagation.
The problem is that there are different C++ ABIs.</p>
<p>Microsoft set their general C++ ABI with their first C++ compilers, and
it has had some changes along the years and versions of their compiler
suite. Intel and Borland, among others, support the Microsoft ABI, and
thus things built with the other generally work, just like with Linux
and the ABI used by GCC. Enter MinGW.</p>
<p>Instead of implementing the Microsoft ABI, the people at GCC and MinGW
decided to just use the same C++ ABI on Windows as they use everywhere
else. And thus we have two groups of compilers that use a different
ABI, and thus we have problems. If you try to load a mingw-built C++
API DLL from a MSVC-built Avisynth. The opposite will not work, either.
The C interface was made exactly for this reason, as pretty much by
chance the ABI for C is (more or less) set, and thus it is generally OK
to mix binaries created by different C compilers.</p>
<p>This is why the Avisynth C API exists: if you want a portable API, you
want a C API. C++ API’s are more or less by definition unportable.</p>
<p>If you want extra reading regarding calling conventions and name
mangling and such ABI-related things, you can read the following PDF
that lists quite a few things of various implementations. Available
<a class="reference external" href="http://www.agner.org/optimize/calling_conventions.pdf">here</a>. Basically these things in general are not fixable by a mere
header, you would have to patch a compiler for the other calling
convention, as well as handle exceptions so that the other side would
understand it as well. And so forth, and so forth. (source: Doom9 forum
posts: <a class="reference external" href="http://forum.doom9.org/showthread.php?p=1653392#post1653392">[1]</a>, <a class="reference external" href="http://forum.doom9.org/showthread.php?p=1653737#post1653737">[2]</a>.)</p>
</div>
<div class="section" id="compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-6-0">
<span id="id2"></span><h2><a class="toc-backref" href="#id20">Compiling AviSynth Plugins step by step instructions (for MS VC++ 6.0)</a><a class="headerlink" href="#compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-6-0" title="Permalink to this headline">¶</a></h2>
<p>Be sure to start with the <a class="reference internal" href="SDKNecessaries.html"><span class="doc">necessary software</span></a>.</p>
<p>Open VC++. Select a new project: Go to the File tab -&gt; New. Select a Win32
Dynamic-Link Library in the Projects tab:</p>
<img alt="../../_images/compiling_plugins.png" src="../../_images/compiling_plugins.png" />
<p>Add the location of your project and the Project Name. The location is the
project folder where the source of your project will be.</p>
<p>Select “An empty DLL project”:</p>
<img alt="../../_images/compiling_plugins2.png" src="../../_images/compiling_plugins2.png" />
<p>Copy existing source files (<em>.cpp), headers (</em>.h) and avisynth.h in your
project folder. If you started from scratch, you only need to copy avisynth.h
in your project folder.</p>
<p>Go to the Project tab -&gt; Add To Project -&gt; Files:</p>
<img alt="../../_images/compiling_plugins3.png" src="../../_images/compiling_plugins3.png" />
<p>Add the existing source files (<em>.cpp), headers (</em>.h) and avisynth.h to your
project. If you start from scratch, you need to a new files to your project:</p>
<p>Go to the Project tab -&gt; Add To project -&gt; New:</p>
<div class="line-block">
<div class="line">1) Select C++ source file, and give it a name.</div>
<div class="line">2) Select C/C++ header file (if you are going to use one), and give it a name.</div>
</div>
<p>Go to the Build tab -&gt; Set Active Configuration -&gt; select the release build.</p>
<p>If you go to the Project tab again -&gt; Settings. Then you should see something
similar as this:</p>
<img alt="../../_images/compiling_plugins4.png" src="../../_images/compiling_plugins4.png" />
<p>Save your workspace: File -&gt; Save Workspace.</p>
<p>Finally, code your source/header files, and compile your plugin. Go to the
Build tab -&gt; Build (…)</p>
<img alt="../../_images/compiling_plugins5.png" src="../../_images/compiling_plugins5.png" />
</div>
<div class="section" id="how-to-debug-avisynth-plugins">
<span id="id3"></span><h2><a class="toc-backref" href="#id21">How to debug AviSynth plugins</a><a class="headerlink" href="#how-to-debug-avisynth-plugins" title="Permalink to this headline">¶</a></h2>
<p>Two ways are described to debug your plugin. An easy way using DebugView and
the use of VC++6’s debugger. In both case, the sample code <a class="reference internal" href="SimpleSample16.html"><span class="doc">SimpleSample v1.6</span></a> is used.</p>
<div class="section" id="how-to-debug-avisynth-plugins-the-short-way">
<span id="id4"></span><h3><a class="toc-backref" href="#id22">How to debug AviSynth plugins (the short way)</a><a class="headerlink" href="#how-to-debug-avisynth-plugins-the-short-way" title="Permalink to this headline">¶</a></h3>
<p>An easy way to debug AviSynth plugin is to use a utility called <a class="reference external" href="http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx">DebugView
for Windows</a> which captures OutputDebugString’s output from your code
(OutputDebugString sends a string to your debugger). It’s a bit limited. So,
if this is not sufficient, you should use a debugger as described in the next
section.</p>
<div class="line-block">
<div class="line">1) Open Dbgview.exe. Make sure that <code class="docutils literal notranslate"><span class="pre">Capture</span> <span class="pre">Win32</span></code> under the Capture tab is selected.</div>
</div>
<div class="line-block">
<div class="line">2) Add the following line at the start of your code:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt; /* for using sprintf */</span>
</pre></div>
</div>
<p>Add, for example, the following lines in your code to check whether certain parameters are passed to the code path which comes after it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">char</span> <span class="n">BUF</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">BUF</span><span class="p">,</span> <span class="s2">&quot;framenr </span><span class="si">%d</span><span class="s2">, text </span><span class="si">%s</span><span class="s2">, height </span><span class="si">%d</span><span class="s2">, pi </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="s2">&quot;hey&quot;</span><span class="p">,</span>
<span class="n">src_height</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">);</span>
<span class="n">OutputDebugString</span><span class="p">(</span><span class="n">BUF</span><span class="p">);</span>
</pre></div>
</div>
<p>Thus:</p>
<img alt="../../_images/debugging_plugins1a.png" src="../../_images/debugging_plugins1a.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Nb</span><span class="p">,</span> <span class="o">%</span><span class="n">d</span> <span class="n">means</span> <span class="n">integer</span><span class="p">,</span> <span class="o">%</span><span class="n">s</span> <span class="n">means</span> <span class="n">string</span> <span class="ow">and</span> <span class="o">%</span><span class="n">f</span> <span class="n">means</span> <span class="nb">float</span><span class="o">/</span><span class="n">double</span><span class="o">.</span> \<span class="n">n</span> <span class="n">means</span> <span class="n">add</span> <span class="n">a</span> <span class="n">new</span> <span class="n">line</span><span class="o">.</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">3) Compile a release build of your plugin.</div>
</div>
<div class="line-block">
<div class="line">4) Open your script and scroll through it. You will see the following output in DebugView:</div>
</div>
<img alt="../../_images/debugging_plugins1b.png" src="../../_images/debugging_plugins1b.png" />
<p>In the example the script is loaded in line 26. After that some AviSynth
output is captured. In the lines 57 and 58 the output of OutputDebugString is
written.</p>
<p>If your script crashes somewhere, you should put these lines just before the
crash (it may take a few attempts to find that point). Then you should pass
the values of the relevant parameters and check whether they are correct.
Apparently there is some parameter whose value is empty or invalid.</p>
</div>
<div class="section" id="how-to-debug-avisynth-plugins-for-ms-vc-6-0">
<span id="id5"></span><h3><a class="toc-backref" href="#id23">How to debug Avisynth plugins (for MS VC++ 6.0)</a><a class="headerlink" href="#how-to-debug-avisynth-plugins-for-ms-vc-6-0" title="Permalink to this headline">¶</a></h3>
<p>These are the steps to debug an AviSynth plugin in VC++ 6:</p>
<div class="line-block">
<div class="line">1. Go to the build tab and set the Active configuration to the Debug version of your plugin.</div>
</div>
<div class="line-block">
<div class="line">2. Build the debug version of your plugin. Thus go to the build tab and <code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">(...)</span></code>.</div>
</div>
<div class="line-block">
<div class="line">3. We will use VirtualDub.exe to debug your plugin. Go to Project tab, then select Settings -&gt; Debug -&gt; General -&gt; Executable for debug session -&gt; browse to a version of VirtualDub.exe and specify that:</div>
</div>
<img alt="../../_images/debugging_plugins2.png" src="../../_images/debugging_plugins2.png" />
<div class="line-block">
<div class="line">4. Go to Project tab, then select Settings -&gt; Debug -&gt; Additional DLLs, and browse to the filter DLL in the Debug directory:</div>
</div>
<img alt="../../_images/debugging_plugins3.png" src="../../_images/debugging_plugins3.png" />
<div class="line-block">
<div class="line">5. Make an AviSynth script that loads and uses your filter. Make sure to load the Debug version of your plugin! Thus for example:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LoadPlugin</span><span class="p">(</span><span class="s2">&quot;F:\CompilingPlugins\SimpleSample\Debug\simplesample.dll&quot;</span><span class="p">)</span>
<span class="n">Colorbars</span><span class="p">()</span><span class="o">.</span><span class="n">Trim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ConvertTORGB24</span><span class="p">()</span>
<span class="n">SimpleSample</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">6. Set breakpoints as required. You can do this by clicking with the right mouse button next to a statement in your code (in the grey section). For example:</div>
</div>
<img alt="../../_images/debugging_plugins4.png" src="../../_images/debugging_plugins4.png" />
<p>Select the option: Insert/Remove Breakpoint:</p>
<img alt="../../_images/debugging_plugins5.png" src="../../_images/debugging_plugins5.png" />
<div class="line-block">
<div class="line">7. Go to the Build tab, and select Start Debug -&gt; Go (or the shortcut F5). VirtualDub will execute. Open the AviSynth script in that VirtualDub instance. The code will execute up to your first breakpoint (at least if it follows that code path):</div>
</div>
<img alt="../../_images/debugging_plugins6.png" src="../../_images/debugging_plugins6.png" />
<p>You will see a yellow arrow through your breakpoint.</p>
<p>Above I also opened the ‘variables output window’. It is under the View tab
-&gt; Debug Windows -&gt; Variables. You can view the value of the variables when
stepping through your code. Use Debug -&gt; Step Into (or the shortcut F11) to
step through your code. Use Debug -&gt; Step Over (or the shortcut F10) to step
over function calls.</p>
<p>When moving your mouse over a variable, you can also see the value of it:</p>
<img alt="../../_images/debugging_plugins7.png" src="../../_images/debugging_plugins7.png" />
<p>If you want to set a breakpoint somewhere else, just remove the existing one
(by right clicking on it). Put a new one somewhere and press F5.</p>
<p>If you want to stop debugging, go to the Debug tab -&gt; Stop Debugging.</p>
</div>
</div>
<div class="section" id="debug-info-from-map-file">
<span id="id6"></span><h2><a class="toc-backref" href="#id24">Debug info from MAP file</a><a class="headerlink" href="#debug-info-from-map-file" title="Permalink to this headline">¶</a></h2>
<p>IanB <a class="reference external" href="http://forum.doom9.org/showthread.php?p=1041578#post1041578">wrote</a>: Recent versions of Avisynth now ship with an avisynth.map! You
can use this accurately get routine addresses. Avisynth preferably loads at
0x10000000, use the debugger loaded module display to check this.</p>
<p>Build your plugin in debug mode. If you can, build yourself a Debug or Relsym
avisynth.dll and debug it, if not the use the .map file provided to
interprete the Call stack addresses.</p>
</div>
<div class="section" id="compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-2005-express-edition">
<span id="id7"></span><h2><a class="toc-backref" href="#id25">Compiling AviSynth Plugins step by step instructions (for MS VC++ 2005 Express Edition)</a><a class="headerlink" href="#compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-2005-express-edition" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setup-vc-2005-express-edition-environment">
<span id="id8"></span><h3><a class="toc-backref" href="#id26">Setup VC++ 2005 Express Edition environment</a><a class="headerlink" href="#setup-vc-2005-express-edition-environment" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Install MS VC++ 2005 Express Edition.</li>
</ul>
<div class="line-block">
<div class="line"><a class="reference external" href="http://www.microsoft.com/express/2005/">http://www.microsoft.com/express/2005/</a></div>
<div class="line">It is web-based install, but you need to register (which you can do freely).</div>
</div>
<div class="line-block">
<div class="line">I prefer manual installation with full CD image download. It may be used on computer without Internet access.</div>
<div class="line"><a class="reference external" href="http://go.microsoft.com/fwlink/?linkid=57034">http://go.microsoft.com/fwlink/?linkid=57034</a></div>
</div>
<p>Run it at least once before installing the SDK</p>
<ul class="simple">
<li>Install Microsoft Platform SDK</li>
</ul>
<p>Last version is at <a class="reference external" href="http://www.microsoft.com/downloads/details.aspx?FamilyId=0BAF2B35-C656-4969-ACE8-E4C0C0716ADB">http://www.microsoft.com/downloads/details.aspx?FamilyId=0BAF2B35-C656-4969-ACE8-E4C0C0716ADB</a></p>
<p>Previous versions works fine too (and older February 2003).</p>
<p><a class="reference external" href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/">http://www.microsoft.com/msdownload/platformsdk/sdkupdate/</a></p>
<p><a class="reference external" href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm">http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm</a></p>
<p>It seems, you need install Core component only with Web install, but you may
prefer full or ISO download for offline computer.</p>
<ul class="simple">
<li>Update the Visual C++ directories in the Projects and Solutions
section in the Options dialog box.</li>
</ul>
<p>Add the paths to the appropriate subsection (change ‘Microsoft Platform SDK
for Windows Server 2003 R2’ in following strings by your real path of
installed version of Microsoft SDK):</p>
<p>Add to Executable files: <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\Microsoft</span> <span class="pre">Platform</span> <span class="pre">SDK</span> <span class="pre">for</span> <span class="pre">Windows</span>
<span class="pre">Server</span> <span class="pre">2003</span> <span class="pre">R2\Bin</span></code></p>
<p>Add to Include files: <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\Microsoft</span> <span class="pre">Platform</span> <span class="pre">SDK</span> <span class="pre">for</span> <span class="pre">Windows</span>
<span class="pre">Server</span> <span class="pre">2003</span> <span class="pre">R2\Include</span></code></p>
<p>Add to Library files: <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\Microsoft</span> <span class="pre">Platform</span> <span class="pre">SDK</span> <span class="pre">for</span> <span class="pre">Windows</span>
<span class="pre">Server</span> <span class="pre">2003</span> <span class="pre">R2\Lib</span></code></p>
<p>See <a class="reference external" href="http://msdn.microsoft.com/vstudio/express/visualc/usingpsdk/">http://msdn.microsoft.com/vstudio/express/visualc/usingpsdk/</a></p>
<ul class="simple">
<li>Update the corewin_express.vsprops file.</li>
</ul>
<p>To make the Win32 template work in Visual C++ Express you need to edit the
corewin_express.vsprops file (found in <code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\Microsoft</span> <span class="pre">Visual</span>
<span class="pre">Studio</span> <span class="pre">8\VC\VCProjectDefaults</span></code>) and change the string that reads:</p>
<p>AdditionalDependencies=”kernel32.lib” to</p>
<p>AdditionalDependencies=”kernel32.lib user32.lib gdi32.lib winspool.lib
comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib”</p>
<p>This step is usually not needed for most AviSynth plugins (kernel.lib is
enough), but sometimes you may need in some other library, in particular
User.Lib for debug.</p>
<ul class="simple">
<li>Enable Win32 Windows Application type in the Win32 Application
Wizard.</li>
</ul>
<p>To enable that type, you need to edit the file AppSettings.htm file located
in the folder <code class="docutils literal notranslate"><span class="pre">%ProgramFiles%/Microsoft</span> <span class="pre">Visual</span> <span class="pre">Studio</span> <span class="pre">8/VC/VCWizards/AppWiz/Generic/Application/html/1033/</span></code>.</p>
<p>In a text editor comment out lines 441 - 444 by putting a // in front of them
as shown here:</p>
<p>// WIN_APP.disabled = true;</p>
<p>// WIN_APP_LABEL.disabled = true;</p>
<p>// DLL_APP.disabled = true;</p>
<p>// DLL_APP_LABEL.disabled = true;</p>
<p>Save and close the file and open Visual C++ Express.</p>
<p>This step is optional if you have project file for plugin (new or old C++
version) and do not create new plugin from scratch.</p>
</div>
<div class="section" id="how-to-compile-existant-old-ms-vc-6-0-plugin-with-ms-vc-2005">
<span id="id9"></span><h3><a class="toc-backref" href="#id27">How to compile existant (old MS VC 6.0) plugin with MS VC++ 2005</a><a class="headerlink" href="#how-to-compile-existant-old-ms-vc-6-0-plugin-with-ms-vc-2005" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Start VC++ 2005, go to folder with old plugin (e.g. <a class="reference internal" href="SimpleSample.html"><span class="doc">SimpleSample</span></a>)
unpacked zip file with full source codes and project files, and open
plugin workspace file SimpleSample.dsw.</li>
<li>Agree in dialog to convert and open this project.</li>
<li>Go to menu Build -&gt; Configuration Manager, Set active solution
configuration to Release (or Debug if you want firsly debug it).</li>
<li>Go to Build -&gt; Build Solution (F7) to compile and create
SimpleSample.dll</li>
<li>If you get fatal error LNK1181: cannot open input file ‘odbc32.lib’,
then go to menu Project -&gt; SimpleSample Properties. Select Configuration
Properties -&gt; Linker -&gt; Input -&gt; Additional Dependencies, and remove
extra unneeded libraries like odbc32.lib, odbccp32.lib.</li>
<li>Also check Linker -&gt; Output File option there and set approriate
pathname (or Inherit From Process default).</li>
<li>You can make some changes (edit) of source codes if you want.</li>
<li>Repeat command Build -&gt; Build Solution (F7) to compile and create
SimpleSample.dll</li>
</ul>
</div>
<div class="section" id="how-to-create-new-plugin-from-scratch-with-ms-vc-2005">
<span id="id10"></span><h3><a class="toc-backref" href="#id28">How to create new plugin from scratch with MS VC++ 2005</a><a class="headerlink" href="#how-to-create-new-plugin-from-scratch-with-ms-vc-2005" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Start VC++2005.</li>
<li>Menu: fiIe -&gt; Create new project.</li>
<li>Select Win32 console appication.</li>
<li>Enter name of your new project and press OK.</li>
<li>You will in Win32 Appcilation Wizard. Press Application Settings
(left panel).</li>
<li>Select Application Type as DLL (but it may be console too).</li>
<li>At Additional options select “Empty project”</li>
<li>Copy files to project folder with Explorer.</li>
<li>Add header file avisynth.h to the project: Menu Project -&gt; Add
existent item. Also add existant (e.g. simplesample.cpp) or create new
CPP files by Project -&gt; Add new item.</li>
<li>Go to menu Build -&gt; Configuration Manager, Set active solution
configuration to Release (or Debug if you want firsly debug it).</li>
<li>Make some changes (edit) of source codes to implement your algorithm.
See <a class="reference internal" href="SimpleSample.html"><span class="doc">SimpleSample</span></a> or some other open source plugin source code and
Avisynth <a class="reference internal" href="FilterSDK.html"><span class="doc">FilterSDK</span></a> for details.</li>
<li>Go to Build -&gt; Build Solution (F7) to compile and create plugin
SimpleSample.dll</li>
</ul>
</div>
</div>
<div class="section" id="compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-2008-professional-edition">
<span id="id11"></span><h2><a class="toc-backref" href="#id29">Compiling AviSynth Plugins step by step instructions (for MS VC++ 2008 Professional Edition)</a><a class="headerlink" href="#compiling-avisynth-plugins-step-by-step-instructions-for-ms-vc-2008-professional-edition" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>In this guide, we will compile the Example plugin from CPP for C
programmers, from
<a class="reference external" href="http://forum.doom9.org/showthread.php?p=1538557#post1538557">http://forum.doom9.org/showthread.php?p=1538557#post1538557</a> or
directly from <a class="reference external" href="http://www.mediafire.com/download.php?tc61m9otustmy29">http://www.mediafire.com/download.php?tc61m9otustmy29</a></li>
<li>Start Microsoft Visual Studio 2008</li>
<li>Upon first start, you are asked to set up your environment. You may
choose the typical Visual C++ option</li>
<li>Choose File-&gt;New-&gt;Project or click the New Project icon</li>
<li>On the left pane, under Project Types, expand Visual C++ and select
Win32</li>
<li>On the right pane, choose Win32 Console Application</li>
<li>Enter a name for your project (in this example we will use Example),
click OK</li>
<li>You may get an error: An error has occurred in this dialog, Error:
54, Unspecified Error. This may be because you installed some windows
updates but didn’t reboot yet. Click OK.</li>
<li>You are shown the current project settings. Click Next.</li>
<li>Under Application Type, click the DLL option. Under Additional
options, check the Empty project box.</li>
<li>A new directory is created, <code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">Documents\Visual</span> <span class="pre">Studio</span>
<span class="pre">2008\Projects\Example</span></code></li>
<li>You need to extract the files from our example plugin into
<code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">Documents\Visual</span> <span class="pre">Studio</span> <span class="pre">2008\Projects\Example\Example</span></code></li>
<li>In the default layout, there is a Solution Explorer pane on the left
side. Right click Header Files, and select Add-&gt;Existing Item, select
avisynth.h and click Add</li>
<li>Continue to add the other files, Info.h and InfoF.h</li>
<li>Right click Source Files, select Add-&gt;Existing Item, and select
Example.cpp</li>
<li>Click Build-&gt;Build Solution (this will give errors!)</li>
<li>There’s a lot of errors about OutputDebugStringW. To fix this, select
Project-&gt;Example Properties</li>
<li>In the left pane, Expand Configuration Properties, select General</li>
<li>In the right pane, click Character Set. Use the drop-down to select
Use Multi-Byte Character Set. Click OK.</li>
<li>Click Build-&gt;Build Solution (this may give errors!)</li>
<li>In the version 0.3 of the plugin, there was an error,
<code class="docutils literal notranslate"><span class="pre">example.cpp(610)</span> <span class="pre">:</span> <span class="pre">error</span> <span class="pre">C4430:</span> <span class="pre">missing</span> <span class="pre">type</span> <span class="pre">specifier</span> <span class="pre">-</span> <span class="pre">int</span> <span class="pre">assumed</span></code>.
To fix this, double-click that error line to highlight it’s location in
the example.cpp source file. Change <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">wstep</span> <span class="pre">=</span> <span class="pre">(vi.IsRGB24())</span> <span class="pre">?</span> <span class="pre">3</span> <span class="pre">:</span>
<span class="pre">4;</span> <span class="pre">//</span> <span class="pre">3</span> <span class="pre">bytes</span> <span class="pre">for</span> <span class="pre">RGB24,</span> <span class="pre">&amp;</span> <span class="pre">4</span> <span class="pre">for</span> <span class="pre">RGB32.</span></code> to <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">int</span> <span class="pre">wstep</span> <span class="pre">=</span>
<span class="pre">(vi.IsRGB24())</span> <span class="pre">?</span> <span class="pre">3</span> <span class="pre">:</span> <span class="pre">4;</span> <span class="pre">//</span> <span class="pre">3</span> <span class="pre">bytes</span> <span class="pre">for</span> <span class="pre">RGB24,</span> <span class="pre">&amp;</span> <span class="pre">4</span> <span class="pre">for</span> <span class="pre">RGB32.</span></code></li>
<li>Click Build-&gt;Build Solution</li>
<li>If you get an error <code class="docutils literal notranslate"><span class="pre">unresolved</span> <span class="pre">external</span> <span class="pre">symbol</span> <span class="pre">_main</span> <span class="pre">referenced</span> <span class="pre">in</span>
<span class="pre">function</span> <span class="pre">___tmainCRTStartup</span></code>, then you’re trying to build an .exe. Use
Project-&gt;Example Properties, Configuration Properties, General, set
Configuration Type to Dynamic Library (.dll)</li>
<li>By default, a debug version is made. To change this,
Build-&gt;Configuration Manager, select Release in the left drop-down</li>
<li>You will have to re-apply the configuration changes: Project-&gt;Example
Properties, Configuration Properties, General, Configuration Type=Dynamic
Library (.dll) and Character Set=Use Multi-Byte Character Set</li>
<li>The following file should appear: <code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">Documents\Visual</span> <span class="pre">Studio</span>
<span class="pre">2008\Projects\Example\Release\Example.dll</span></code>. Note that there is also a
directory <code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">Documents\Visual</span> <span class="pre">Studio</span>
<span class="pre">2008\Projects\Example\Example\Release</span></code> which contains only tempory files,
but not the dll. This is set under Project-&gt;Example Properties, General,
Output Directory=$(SolutionDir)$(ConfigurationName), Intermediate
Directory=$(ConfigurationName). In this case <code class="docutils literal notranslate"><span class="pre">$(SolutionDir)=My</span>
<span class="pre">Documents\Visual</span> <span class="pre">Studio</span> <span class="pre">2008\Projects\Example</span></code>,
$(ConfigurationName)=Release.</li>
<li>You need to copy Example.dll to your Avisynth plugins directory, and
then test it with the Example.avs file.</li>
<li>If everything worked, you can proceed to modify the example by
following the comments, or also using the SimnpleSample included in the
Avisynth distribution.</li>
</ul>
</div>
<div class="section" id="compiling-avisynth-plugins-or-console-applications-step-by-step-instructions-for-ms-vc-2010-express-and-professional-edition">
<span id="id12"></span><h2><a class="toc-backref" href="#id30">Compiling AviSynth Plugins or Console Applications step by step instructions (for MS VC++ 2010 Express and Professional Edition)</a><a class="headerlink" href="#compiling-avisynth-plugins-or-console-applications-step-by-step-instructions-for-ms-vc-2010-express-and-professional-edition" title="Permalink to this headline">¶</a></h2>
<p>These instructions are also valid for the 2008 editions. Be sure to
start with the <a class="reference internal" href="SDKNecessaries.html"><span class="doc">necessary software</span></a>.</p>
<div class="section" id="creating-a-new-project">
<span id="id13"></span><h3><a class="toc-backref" href="#id31">Creating a new project</a><a class="headerlink" href="#creating-a-new-project" title="Permalink to this headline">¶</a></h3>
<p>Open MSVC++ 2010. Select a new project:</p>
<img alt="../../_images/Compiling_plugins_msvc2010_001.jpg" src="../../_images/Compiling_plugins_msvc2010_001.jpg" />
<p>Select a Win32 Console Application. Add the location of your project
and the project name. The LocationName will be the project folder (or
Solution Directory as MSVC++ 2010 calls it) where the source of your
project will be. If the folder “Name” already exists the ‘Create
directory for solution’ box should be left unchecked, otherwise it will
create as a subfolder regardless.</p>
<img alt="../../_images/Compiling_plugins_msvc2010_002.jpg" src="../../_images/Compiling_plugins_msvc2010_002.jpg" />
<p>Select application settings. When creating a plugin check the
application type ‘DLL’ and when creating a console application (such as
avs2wav.exe for example) check the application type ‘Console
application’. Also check the additional option ‘Empty project’ boxes.
Click on finish:</p>
<img alt="../../_images/Compiling_plugins_msvc2010_003.jpg" src="../../_images/Compiling_plugins_msvc2010_003.jpg" />
<p>In the Solution Explorer window, the solution has the ‘folders’
External Dependencies, Header Files, Resource Files and Source Files:</p>
<img alt="../../_images/Compiling_plugins_msvc2010_004.jpg" src="../../_images/Compiling_plugins_msvc2010_004.jpg" />
<p>Copy existing source files (<em>.cpp), headers (</em>.h) and avisynth.h in
your project folder. If you started from scratch, you only need to copy
avisynth.h in your project folder.</p>
<p>You can add the source and header files to your project by
right-clicking on a ‘folder’ (say Header Files as in the screenshot
below), select Add and Existing Item (or New Item if you start from
scratch):</p>
<img alt="../../_images/Compiling_plugins_msvc2010_005.jpg" src="../../_images/Compiling_plugins_msvc2010_005.jpg" />
<p>Select the release build, since we are building the release build.</p>
</div>
<div class="section" id="general-settings">
<span id="id14"></span><h3><a class="toc-backref" href="#id32">General settings</a><a class="headerlink" href="#general-settings" title="Permalink to this headline">¶</a></h3>
<p>If it’s your first time you need to select the expert settings to make
the build tab visible:</p>
<p>Tools &gt; Settings &gt; Expert Settings</p>
<img alt="../../_images/Compiling_plugins_msvc2010_006.jpg" src="../../_images/Compiling_plugins_msvc2010_006.jpg" />
<p>In the property page you can see (and change) the location of the DLL
that will be build:</p>
<p>Right click on the project name (InvertNeg in our case) &gt; Properties &gt;
Configuration Properties &gt; General</p>
<p>The default location is $(SolutionDir)$(Configuration). You have set
the ‘SolutionDir’ when defining the project
(<code class="docutils literal notranslate"><span class="pre">D:\AviSynth\Plugins|InvertNeg</span></code> in our case). ‘Configuration’ will be
the Release or Debug folder depending on which configuration you have
selected.</p>
<img alt="../../_images/Compiling_plugins_msvc2010_007.jpg" src="../../_images/Compiling_plugins_msvc2010_007.jpg" />
<p>Next you need to be aware of the VC++ Directories and change them if
necessary:</p>
<p>Right click on the project name (InvertNeg in our case) &gt; Properties &gt;
Configuration Properties &gt; VC++ Directories</p>
<p>Here you will find the location of the ‘Include Directories’ and
others. $(VCInstallDir)include points to the include folder of MSVC++
2010 and $(WindowsSdkDir)include to the include folder of the Microsoft
Platform SDK. When including headers (such as windows.h) in your
project they will be searched for in the include folders (unless you
explicitly add its location when including them). So both of them
should point to the correct folders.</p>
<p>Note that in general windows.h should be included in your project. It
is the header file for accessing the Win32 API through C/C++ and it is
located in the include folder of the Microsoft Platform SDK.</p>
<img alt="../../_images/Compiling_plugins_msvc2010_008.jpg" src="../../_images/Compiling_plugins_msvc2010_008.jpg" />
<p>You can see the values of VCInstallDir and WindowsSdkDir when opening
the VS command prompt:</p>
<p>Tools &gt; Visual Studio &gt; Command Prompt</p>
<p>The VS command prompt will be loaded. Type set and you will see the
variables. They will be set when starting MSVC++ 2010 (by vsvars32.bat
which is located in your <code class="docutils literal notranslate"><span class="pre">&lt;VisualStudioInstallDir&gt;\Common7\Tools</span></code>
folder).</p>
</div>
<div class="section" id="building-the-plugin-or-console-application">
<span id="id15"></span><h3><a class="toc-backref" href="#id33">Building the plugin or console application</a><a class="headerlink" href="#building-the-plugin-or-console-application" title="Permalink to this headline">¶</a></h3>
<p>Now you are ready to build you DLL/EXE. Go to</p>
<p>Build &gt; Build Solution</p>
<p>And you will find your compiled plugin in the LocationNameFolder.</p>
<img alt="../../_images/Compiling_plugins_msvc2010_009.jpg" src="../../_images/Compiling_plugins_msvc2010_009.jpg" />
<hr class="docutils" />
<p>Back to <a class="reference internal" href="FilterSDK.html"><span class="doc">FilterSDK</span></a></p>
<p>$Date: 2014/10/27 22:04:54 $</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Cplusplus_api.html" title="C++ API"
             >next</a> |</li>
        <li class="right" >
          <a href="ColorspaceProperties.html" title="Colorspace properties"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>