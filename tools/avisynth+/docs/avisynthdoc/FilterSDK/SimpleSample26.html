

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>SimpleSample &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SimpleSampleClass" href="SimpleSampleClass.html" />
    <link rel="prev" title="SimpleSample 1.7" href="SimpleSample17.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="SimpleSampleClass.html" title="SimpleSampleClass"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="SimpleSample17.html" title="SimpleSample 1.7"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">SimpleSample</a><ul>
<li><a class="reference internal" href="#line-by-line-breakdown">Line by line breakdown</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="SimpleSample17.html"
                        title="previous chapter">SimpleSample 1.7</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="SimpleSampleClass.html"
                        title="next chapter">SimpleSampleClass</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/FilterSDK/SimpleSample26.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="simplesample">
<h1>SimpleSample<a class="headerlink" href="#simplesample" title="Permalink to this headline">¶</a></h1>
<p>I have rewritten SimpleSample for AviSynth 2.6. I changed it into an in
place filter (so the source is overwritten). It draws a white square in
the center of the clip and it supports all colorformats.</p>
<p>Here’s simplesample.cpp:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;windows.h&gt;</span>
<span class="c1">#include &quot;avisynth.h&quot;</span>

<span class="k">class</span> <span class="nc">SimpleSample</span> <span class="p">:</span> <span class="n">public</span> <span class="n">GenericVideoFilter</span> <span class="p">{</span>
   <span class="nb">int</span> <span class="n">SquareSize</span><span class="p">;</span>
<span class="n">public</span><span class="p">:</span>
   <span class="n">SimpleSample</span><span class="p">(</span><span class="n">PClip</span> <span class="n">_child</span><span class="p">,</span> <span class="nb">int</span> <span class="n">_SquareSize</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">);</span>
   <span class="o">~</span><span class="n">SimpleSample</span><span class="p">();</span>
   <span class="n">PVideoFrame</span> <span class="n">__stdcall</span> <span class="n">GetFrame</span><span class="p">(</span><span class="nb">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">SimpleSample</span><span class="p">::</span><span class="n">SimpleSample</span><span class="p">(</span><span class="n">PClip</span> <span class="n">_child</span><span class="p">,</span> <span class="nb">int</span> <span class="n">_SquareSize</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">:</span>
   <span class="n">GenericVideoFilter</span><span class="p">(</span><span class="n">_child</span><span class="p">),</span> <span class="n">SquareSize</span><span class="p">(</span><span class="n">_SquareSize</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">width</span><span class="o">&lt;</span><span class="n">SquareSize</span> <span class="o">||</span> <span class="n">vi</span><span class="o">.</span><span class="n">height</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">env</span><span class="o">-&gt;</span><span class="n">ThrowError</span><span class="p">(</span><span class="s2">&quot;SimpleSample: square doesn&#39;t fit into the clip!&quot;</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="n">SimpleSample</span><span class="p">::</span><span class="o">~</span><span class="n">SimpleSample</span><span class="p">()</span> <span class="p">{}</span>

<span class="n">PVideoFrame</span> <span class="n">__stdcall</span> <span class="n">SimpleSample</span><span class="p">::</span><span class="n">GetFrame</span><span class="p">(</span><span class="nb">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">{</span>

   <span class="n">PVideoFrame</span> <span class="n">src</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">GetFrame</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">env</span><span class="p">);</span>
   <span class="n">env</span><span class="o">-&gt;</span><span class="n">MakeWritable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">src</span><span class="p">);</span>

   <span class="n">unsigned</span> <span class="n">char</span><span class="o">*</span> <span class="n">srcp</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetWritePtr</span><span class="p">();</span>
   <span class="nb">int</span> <span class="n">src_pitch</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetPitch</span><span class="p">();</span>
   <span class="nb">int</span> <span class="n">src_width</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetRowSize</span><span class="p">();</span>
   <span class="nb">int</span> <span class="n">src_height</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetHeight</span><span class="p">();</span>

   <span class="nb">int</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">woffset</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB24</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

      <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">+=</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
            <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
            <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB32</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

      <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">*</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">+=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
            <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
            <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="o">/*</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB32</span><span class="p">())</span> <span class="p">{</span> <span class="o">//</span> <span class="n">variant</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">processing</span> <span class="n">a</span> <span class="n">pixel</span> <span class="n">at</span> <span class="n">once</span>
      <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

      <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">*</span><span class="p">((</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span><span class="p">)</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x00FFFFFF</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="o">*/</span>
<span class="o">/*</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB32</span><span class="p">())</span> <span class="p">{</span> <span class="o">//</span> <span class="n">variant</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">processing</span> <span class="n">a</span> <span class="n">pixel</span> <span class="n">at</span> <span class="n">once</span>
      <span class="n">unsigned</span> <span class="nb">int</span><span class="o">*</span> <span class="n">srcp</span> <span class="o">=</span> <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">*</span><span class="p">)</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">GetWritePtr</span><span class="p">();</span>

      <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>

      <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">srcp</span><span class="p">[</span><span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00FFFFFF</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="o">*/</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsYUY2</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

      <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">*</span><span class="p">((</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span><span class="p">)</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x80EB80EB</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsPlanar</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">vi</span><span class="o">.</span><span class="n">IsYUV</span><span class="p">())</span> <span class="p">{</span>

      <span class="nb">int</span> <span class="n">planes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">PLANAR_Y</span><span class="p">,</span> <span class="n">PLANAR_U</span><span class="p">,</span> <span class="n">PLANAR_V</span><span class="p">};</span>
      <span class="nb">int</span> <span class="n">square_value</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">235</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">};</span>
      <span class="nb">int</span> <span class="n">p</span><span class="p">;</span>
      <span class="nb">int</span> <span class="n">width_sub</span><span class="p">,</span> <span class="n">height_sub</span><span class="p">;</span>

      <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">srcp</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetWritePtr</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
         <span class="n">src_pitch</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetPitch</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
         <span class="n">src_width</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetRowSize</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
         <span class="n">src_height</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetHeight</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
         <span class="n">width_sub</span> <span class="o">=</span> <span class="n">vi</span><span class="o">.</span><span class="n">GetPlaneWidthSubsampling</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
         <span class="n">height_sub</span> <span class="o">=</span> <span class="n">vi</span><span class="o">.</span><span class="n">GetPlaneHeightSubsampling</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>

         <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">height_sub</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

         <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">width_sub</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

         <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">height_sub</span><span class="p">);</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">width_sub</span><span class="p">);</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
               <span class="n">srcp</span><span class="p">[</span><span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">square_value</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="n">src</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">AVSValue</span> <span class="n">__cdecl</span> <span class="n">Create_SimpleSample</span><span class="p">(</span><span class="n">AVSValue</span> <span class="n">args</span><span class="p">,</span> <span class="n">void</span><span class="o">*</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">new</span> <span class="n">SimpleSample</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">AsClip</span><span class="p">(),</span>
                           <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">AsInt</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
                           <span class="n">env</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">const</span> <span class="n">AVS_Linkage</span> <span class="o">*</span><span class="n">AVS_linkage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="n">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">__stdcall</span> <span class="n">AvisynthPluginInit3</span><span class="p">(</span><span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">,</span> <span class="n">const</span> <span class="n">AVS_Linkage</span><span class="o">*</span> <span class="n">const</span> <span class="n">vectors</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">AVS_linkage</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">;</span>
   <span class="n">env</span><span class="o">-&gt;</span><span class="n">AddFunction</span><span class="p">(</span><span class="s2">&quot;SimpleSample&quot;</span><span class="p">,</span> <span class="s2">&quot;c[size]i&quot;</span><span class="p">,</span> <span class="n">Create_SimpleSample</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
   <span class="k">return</span> <span class="s2">&quot;SimpleSample plugin&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Compile this file into a DLL named InvertNeg.dll. See <a class="reference internal" href="CompilingAvisynthPlugins.html"><span class="doc">compiling instructions</span></a>.
Now create an Avisynth script which looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LoadPlugin</span><span class="p">(</span><span class="s2">&quot;d:\path\simplesample.dll&quot;</span><span class="p">)</span>
<span class="n">Colorbars</span><span class="p">()</span><span class="o">.</span><span class="n">Trim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ConvertTORGB32</span><span class="p">()</span>
<span class="c1"># ConvertTOYV411()</span>
<span class="n">SimpleSample</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="line-by-line-breakdown">
<h2>Line by line breakdown<a class="headerlink" href="#line-by-line-breakdown" title="Permalink to this headline">¶</a></h2>
<p>Here’s a line-by-line breakdown of simplesample.cpp. I won’t repeat the
comments in the previous example InvertNeg.cpp, so read that first if
needed. The declaration of the class is as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleSample</span> <span class="p">:</span> <span class="n">public</span> <span class="n">GenericVideoFilter</span> <span class="p">{</span>
   <span class="nb">int</span> <span class="n">SquareSize</span><span class="p">;</span>
<span class="n">public</span><span class="p">:</span>
   <span class="n">SimpleSample</span><span class="p">(</span><span class="n">PClip</span> <span class="n">_child</span><span class="p">,</span>   <span class="nb">int</span> <span class="n">_SquareSize</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">);</span>
   <span class="o">~</span><span class="n">SimpleSample</span><span class="p">();</span>
   <span class="n">PVideoFrame</span> <span class="n">__stdcall</span> <span class="n">GetFrame</span><span class="p">(</span><span class="nb">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>With respect to our previous example there are two differences. It
contains a private data member ‘SquareSize’ (members are private by
default). Note that this is our parameter variable. These have to be
declared here.</p>
<p>The member function ~SimpleSample() is the declaration of the
destructor. It fulfills the opposite functionality as the constructor.
It is automatically called when the filter is destroyed. It is used to
release allocated memory when the filter is destroyed. This is needed
when there is memory allocated in the constructor. This is not the case
in our filter, so we didn’t need to declare it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SimpleSample</span><span class="p">::</span><span class="o">~</span><span class="n">SimpleSample</span><span class="p">()</span> <span class="p">{}</span>
</pre></div>
</div>
<p>This is the actual destructor. You can release allocated memory here
using the operator delete.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SimpleSample</span><span class="p">::</span><span class="n">SimpleSample</span><span class="p">(</span><span class="n">PClip</span> <span class="n">_child</span><span class="p">,</span> <span class="nb">int</span> <span class="n">_SquareSize</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">:</span>
   <span class="n">GenericVideoFilter</span><span class="p">(</span><span class="n">_child</span><span class="p">),</span> <span class="n">SquareSize</span><span class="p">(</span><span class="n">_SquareSize</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">width</span><span class="o">&lt;</span><span class="n">SquareSize</span> <span class="o">||</span> <span class="n">vi</span><span class="o">.</span><span class="n">height</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">env</span><span class="o">-&gt;</span><span class="n">ThrowError</span><span class="p">(</span><span class="s2">&quot;SimpleSample: square doesn&#39;t fit into the clip!&quot;</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is the constructor. It initializes the value of SquareSize with
the parameter that is passed to it (which is called _SquareSize here).
It also checks whether the square which will be drawn fits in the
frame, otherwise it will return an error.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unsigned</span> <span class="n">char</span><span class="o">*</span> <span class="n">srcp</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetWritePtr</span><span class="p">();</span>
<span class="nb">int</span> <span class="n">src_pitch</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetPitch</span><span class="p">();</span>
<span class="nb">int</span> <span class="n">src_width</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetRowSize</span><span class="p">();</span>
<span class="nb">int</span> <span class="n">src_height</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetHeight</span><span class="p">();</span>
</pre></div>
</div>
<p>The default value of plane is PLANAR_Y (= 0) for the functions
GetReadPtr, GetWritePtr, GetPitch, GetRowSize and GetHeight. For planar
formats this is the luma plane and for interleaved formats this is the
whole frame.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB24</span><span class="p">())</span> <span class="p">{</span>
</pre></div>
</div>
<p>When the clip has color format RGB24 the code path is taken. For RGB24
each pixel is represented by three bytes, blue, green and red (in that
order). RGB is up side down, so srcp[0] will be the bottom-left pixel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>
</pre></div>
</div>
<p>The pointer is moved to the lower line of the square that will be
drawn. Remember that src_height is the height in pixels.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
<p>The offset is calculated of the left most byte of the square that will
be drawn. Remember that src_width is the width in bytes. Since
SquareSize is specified in pixels, the corresponding number of bytes is
3*SquareSize.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>         <span class="o">//</span> <span class="n">Loop</span> <span class="kn">from</span> <span class="nn">bottom</span> <span class="n">line</span> <span class="n">to</span> <span class="n">top</span> <span class="n">line</span><span class="o">.</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">+=</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>   <span class="o">//</span> <span class="n">Loop</span> <span class="kn">from</span> <span class="nn">left</span> <span class="n">side</span> <span class="n">of</span> <span class="n">the</span> <span class="n">image</span> <span class="n">to</span> <span class="n">the</span> <span class="n">right</span> <span class="n">side</span> <span class="mi">1</span> <span class="n">pixel</span> <span class="p">(</span><span class="mi">3</span> <span class="nb">bytes</span><span class="p">)</span> <span class="n">at</span> <span class="n">a</span> <span class="n">time</span>
         <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>     <span class="o">//</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">same</span> <span class="k">as</span> <span class="n">srcp</span><span class="p">[</span><span class="n">woffset</span><span class="o">+</span><span class="n">w</span><span class="p">]</span><span class="o">=</span><span class="mi">255</span><span class="p">;</span>
         <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="o">//</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">same</span> <span class="k">as</span> <span class="n">srcp</span><span class="p">[</span><span class="n">woffset</span><span class="o">+</span><span class="n">w</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">255</span><span class="p">;</span>
         <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="o">//</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">same</span> <span class="k">as</span> <span class="n">srcp</span><span class="p">[</span><span class="n">woffset</span><span class="o">+</span><span class="n">w</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">255</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here the white square is drawn. Each color component is set to 255.</p>
<p>For RGB32 the following code path is taken</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB32</span><span class="p">())</span> <span class="p">{</span>
   <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

   <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

   <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">*</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">+=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
         <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
         <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
         <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It’s the same as for RGB24, except a pixel is represented by four
bytes, blue, green, red and alpha (in that order). Since SquareSize is
specified in pixels, the corresponding number of bytes is <code class="docutils literal notranslate"><span class="pre">4*SquareSize</span></code>.
The fourth color component, the alpha channel, <code class="docutils literal notranslate"><span class="pre">*(srcp</span> <span class="pre">+</span> <span class="pre">woffset</span> <span class="pre">+</span> <span class="pre">w</span> <span class="pre">+</span> <span class="pre">3)</span></code>
is left untouched.</p>
<p>It is possible to speed the code above up a bit since you can deal with
whole 32bit variables at a time. This can be done in several ways:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB32</span><span class="p">())</span> <span class="p">{</span> <span class="o">//</span> <span class="n">variant</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">processing</span> <span class="n">a</span> <span class="n">pixel</span> <span class="n">at</span> <span class="n">once</span>
   <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

   <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>   <span class="o">//</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="nb">bytes</span> <span class="n">equals</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="n">pixels</span>

   <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="o">*</span><span class="p">((</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span><span class="p">)</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x00FFFFFF</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You need to cast srcp as unsigned int (instead of unsigned char).
unsigned int is 4 bytes or 32 bits (it runs from 0 to 2^32-1), which is
exactly what we need for one pixel. The casting is done in this line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="p">((</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span><span class="p">)</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x00FFFFFF</span><span class="p">;</span>
</pre></div>
</div>
<p>The value of a white pixel is 0x00FFFFFF (where the alpha pixel is set
to black). When writing several bytes at once, you need to write the
right one first and the left one last.</p>
<p>It is also possible to declare srcp as unsigned int when defining it,
but you have to take it into account in the rest of the code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB32</span><span class="p">())</span> <span class="p">{</span> <span class="o">//</span> <span class="n">variant</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">processing</span> <span class="n">a</span> <span class="n">pixel</span> <span class="n">at</span> <span class="n">once</span>
   <span class="n">unsigned</span> <span class="nb">int</span><span class="o">*</span> <span class="n">srcp</span> <span class="o">=</span> <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">*</span><span class="p">)</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">GetWritePtr</span><span class="p">();</span>

   <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>

   <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

   <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">srcp</span><span class="p">[</span><span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00FFFFFF</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Remember that src_pitch is given in bytes and it is equal to
src_pitch/4 pixels.</p>
<p>For YUY2, each 4 byte sequence represents 2 pixels, (Y1, U, Y2 and then
V). So we can write two pixels at once by recasting again.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsYUY2</span><span class="p">())</span> <span class="p">{</span>
   <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

   <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>

   <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>   <span class="o">//</span> <span class="n">we</span> <span class="n">are</span> <span class="n">writing</span> <span class="n">two</span> <span class="n">pixels</span> <span class="n">at</span> <span class="n">once</span>
         <span class="o">*</span><span class="p">((</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span><span class="p">)</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x80EB80EB</span><span class="p">;</span>   <span class="o">//</span> <span class="n">VY2UY1</span><span class="p">;</span> <span class="n">Y1</span><span class="o">=</span><span class="n">Y2</span><span class="o">=</span><span class="mh">0xEB</span><span class="o">=</span><span class="mi">235</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">V</span><span class="o">=</span><span class="mh">0x80</span><span class="o">=</span><span class="mi">128</span>
      <span class="p">}</span>
      <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At last we move on to the YUV planar formats. Since we are processing
the color components independently we can loop over the planes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsPlanar</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">vi</span><span class="o">.</span><span class="n">IsYUV</span><span class="p">())</span> <span class="p">{</span>
</pre></div>
</div>
<p>All planar YUV formats in the 2.6 api are: YV24, YV16, YV12, YV411 and Y8.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">planes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">PLANAR_Y</span><span class="p">,</span> <span class="n">PLANAR_U</span><span class="p">,</span> <span class="n">PLANAR_V</span><span class="p">};</span>
<span class="nb">int</span> <span class="n">square_value</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">235</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">};</span>
<span class="nb">int</span> <span class="n">p</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">width_sub</span><span class="p">,</span> <span class="n">height_sub</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">srcp</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetWritePtr</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
   <span class="n">src_pitch</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetPitch</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
   <span class="n">src_width</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetRowSize</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
   <span class="n">src_height</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetHeight</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
   <span class="n">width_sub</span> <span class="o">=</span> <span class="n">vi</span><span class="o">.</span><span class="n">GetPlaneWidthSubsampling</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
   <span class="n">height_sub</span> <span class="o">=</span> <span class="n">vi</span><span class="o">.</span><span class="n">GetPlaneHeightSubsampling</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
</pre></div>
</div>
<p>Since the planes have unequal width (measured in bytes; same for
height) we will need their subsampling. The functions
<a class="reference internal" href="VideoInfo.html"><span class="doc">GetPlaneWidthSubsampling</span></a> and <a class="reference internal" href="VideoInfo.html"><span class="doc">GetPlaneHeightSubsampling</span></a> are new in
the 2.6 api. They return the horizontal and vertical subsampling of the
plane compared to the luma plane. The subsampling of the formats is:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="41%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">color format</th>
<th class="head">GetPlaneWidthSubsampling(PLANAR_U)</th>
<th class="head">GetPlaneHeightSubsampling(PLANAR_U)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>YV24</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>YV16</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="row-even"><td>YV12</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>YV411</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="row-even"><td>Y8</td>
<td>0 ?</td>
<td>0 ?</td>
</tr>
</tbody>
</table>
<p>The chroma planes PLANAR_U and PLANAR_V have the same subsampling. Also
GetPlaneWidthSubsampling(PLANAR_Y) =
GetPlaneHeightSubsampling(PLANAR_Y) = 0 since PLANAR_Y is not
subsampled.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">height_sub</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>
</pre></div>
</div>
<p>Note SquareSize is specified in pixels and src_height the height of the
samples of plane p. Let’s look at YV12 for example. For the luma plane
we have SquareSize&gt;&gt;0 = SquareSize since there is no subsampling and
for the chroma planes we have SquareSize&gt;&gt;1 = SquareSize/2 since there
are twice as many luma samples as chroma samples horizontally.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">width_sub</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
<p>The vertical subsampling is taken into account again.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">height_sub</span><span class="p">);</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">width_sub</span><span class="p">);</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">srcp</span><span class="p">[</span><span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">square_value</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
         <span class="p">}</span>
         <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here the white square is drawn. The luma pixels will get the value
square_value[PLANAR_Y] = 235, and the chroma pixels will get the value
square_value[PLANAR_U] = 128 (idem for PLANAR_V).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AVSValue</span> <span class="n">__cdecl</span> <span class="n">Create_SimpleSample</span><span class="p">(</span><span class="n">AVSValue</span> <span class="n">args</span><span class="p">,</span> <span class="n">void</span><span class="o">*</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">new</span> <span class="n">SimpleSample</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">AsClip</span><span class="p">(),</span>
                           <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">AsInt</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
                           <span class="n">env</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>args[0], args[1], … are the arguments of the filter. Here there are
two arguments. The first one is of type clip and the second one of type
int (with default value 100). You can pre-process or post-process your
variables (and clips) here too. See DirectShowSource for some examples.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="n">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">__stdcall</span> <span class="n">AvisynthPluginInit3</span><span class="p">(</span><span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">,</span> <span class="n">const</span> <span class="n">AVS_Linkage</span><span class="o">*</span> <span class="n">const</span> <span class="n">vectors</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">AVS_linkage</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">;</span>
   <span class="n">env</span><span class="o">-&gt;</span><span class="n">AddFunction</span><span class="p">(</span><span class="s2">&quot;SimpleSample&quot;</span><span class="p">,</span> <span class="s2">&quot;c[size]i&quot;</span><span class="p">,</span> <span class="n">Create_SimpleSample</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
   <span class="k">return</span> <span class="s2">&quot;SimpleSample plugin&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="Cplusplus_api.html#cplusplus-addfunction"><span class="std std-ref">AddFunction</span></a> has the following parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AddFunction</span><span class="p">(</span><span class="n">Filtername</span><span class="p">,</span> <span class="n">Arguments</span><span class="p">,</span> <span class="n">Function</span> <span class="n">to</span> <span class="n">call</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p><em>Arguments</em> is a string that defines the types and optional names of the
arguments for your filter. The possible types are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Argument type specifier strings</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="2">c - clip</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td rowspan="2">i - integer</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td rowspan="2">f - float</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td rowspan="2">s - string</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td rowspan="2">b - boolean</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td rowspan="2">. - Any type (dot)</td>
</tr>
<tr class="row-odd"></tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" rowspan="2">Array Specifiers</th>
</tr>
<tr class="row-even"></tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td rowspan="2">i* - Integer Array, zero or more</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2">i+ - Integer Array, one or more</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2">.* - Any type Array, zero or more</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td rowspan="2">.+ - Any type Array, one or more</td>
</tr>
<tr class="row-even"></tr>
</tbody>
</table>
<p>(have a look at StackVertical and SelectEvery for example as to how access such arrays)</p>
<p>The text inside the [ ] lets you used named parameters in your script. Thus</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clip</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">SimpleSample</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>but</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clip</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">SimpleSample</span><span class="p">(</span><span class="n">clip</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>works as well. See <a class="reference internal" href="InvertNeg.html"><span class="doc">InvertNeg</span></a> for more information.</p>
<hr class="docutils" />
<p>Back to <a class="reference internal" href="FilterSDK.html"><span class="doc">AviSynth FilterSDK</span></a></p>
<p>$Date: 2015/09/14 20:23:59 $</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="SimpleSampleClass.html" title="SimpleSampleClass"
             >next</a> |</li>
        <li class="right" >
          <a href="SimpleSample17.html" title="SimpleSample 1.7"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>