

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ColorSpaces &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Colorspace properties" href="ColorspaceProperties.html" />
    <link rel="prev" title="ChangeFrameSize" href="ChangeFrameSize.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ColorspaceProperties.html" title="Colorspace properties"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ChangeFrameSize.html" title="ChangeFrameSize"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ColorSpaces</a><ul>
<li><a class="reference internal" href="#rgb-and-yuv-colorspaces">RGB and YUV colorspaces</a><ul>
<li><a class="reference internal" href="#rgb-colorspaces">RGB Colorspaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yuv-colorspace">YUV colorspace</a><ul>
<li><a class="reference internal" href="#yuy2-colorformat">YUY2 Colorformat</a></li>
<li><a class="reference internal" href="#yv12-colorformat">YV12 Colorformat</a><ul>
<li><a class="reference internal" href="#yv12-interlacing">YV12 interlacing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#links">Links</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ChangeFrameSize.html"
                        title="previous chapter">ChangeFrameSize</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ColorspaceProperties.html"
                        title="next chapter">Colorspace properties</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/FilterSDK/ColorSpaces.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="colorspaces">
<h1>ColorSpaces<a class="headerlink" href="#colorspaces" title="Permalink to this headline">¶</a></h1>
<div class="section" id="rgb-and-yuv-colorspaces">
<h2>RGB and YUV colorspaces<a class="headerlink" href="#rgb-and-yuv-colorspaces" title="Permalink to this headline">¶</a></h2>
<p>RGB and YUV are two different ways to represent colors. In YUV colorspace
there is one component that represent lightness (luma) and two other
components that represent color (chroma). As long as the luma is conveyed
with full detail, detail in the chroma components can be reduced by
subsampling (filtering, or averaging) which can be done in several ways (thus
there are multiple formats for storing a picture in YUV colorspace). In RGB
colorspace there are three components, one for the amount of Red, one for the
amount of Green and one for the amount of Blue. Also in this colorspace there
are multiple formats for storing a picture which differ in the amount of
samples are used for one of the three colors.</p>
<div class="section" id="rgb-colorspaces">
<h3>RGB Colorspaces<a class="headerlink" href="#rgb-colorspaces" title="Permalink to this headline">¶</a></h3>
<p>There are several RGB formats, but the two most widely used are known as
RGB24 and RGB32.</p>
<p>Both of them contain three components, R,G and B - short for Red, Green and
Blue.</p>
<p>RGB24 and RGB32 are both an <a class="reference internal" href="InterleavedImageFormat.html"><span class="doc">InterleavedImageFormat</span></a>. The only difference
between the two are that RGB32 contains an extra byte for each pixel.</p>
<p>The extra byte RGB32 contains is known as an alpha pixel, but it is actually
quite seldom used. The reason RGB32 is considered the “best” format is purely
from a programmers view. Handling RGB32 material is much easier than RGB24
material, because most processors operate on 32bits at the time, and not 24.</p>
</div>
</div>
<div class="section" id="yuv-colorspace">
<h2>YUV colorspace<a class="headerlink" href="#yuv-colorspace" title="Permalink to this headline">¶</a></h2>
<p>There are several YUV formats. There are <a class="reference internal" href="InterleavedImageFormat.html"><span class="doc">interleaved formats</span></a>
and <a class="reference internal" href="PlanarImageFormat.html"><span class="doc">planar formats</span></a> (also called packed formats). The main
difference is how they are stored in memory.</p>
<p>Interleaved images have all color components needed to represent a pixel
placed at the same place in memory. For planar formats the data is not
interleaved, but stored separately for each color channel (also called color
plane). For filter writers this means that they can write one simple function
that is called three times, one for each color channel, assuming that the
operations are channel-independent (which is not always the case). Again,
using aligned for both color and luma channels will allow easy memory access.
The use of a planar format gives in most cases a significant speedup, since
all bytes of each plane can be treated the same way. It can also give a
speedup because your filter doesn’t have to work on all planes, if it only
modifies one or two of them.</p>
<div class="section" id="yuy2-colorformat">
<h3>YUY2 Colorformat<a class="headerlink" href="#yuy2-colorformat" title="Permalink to this headline">¶</a></h3>
<p>YUY2 is an <a class="reference internal" href="InterleavedImageFormat.html"><span class="doc">Interleaved Image Format</span></a>. Bytes are arranged in memory like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">YUYV|YUYV|YUYV|YUYV|YUYV|YUYV|...</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">^first</span> <span class="pre">byte</span> <span class="pre">in</span> <span class="pre">a</span> <span class="pre">row.</span></code></p>
<p>So each pixel horizontally shares UV (chroma) information with a neighboring
pixel.</p>
</div>
<div class="section" id="yv12-colorformat">
<h3>YV12 Colorformat<a class="headerlink" href="#yv12-colorformat" title="Permalink to this headline">¶</a></h3>
<p>The YV12 colorformat is very different from RGB and YUY2 colorformats. The
main difference is that it is a <a class="reference internal" href="PlanarImageFormat.html"><span class="doc">PlanarImageFormat</span></a>. That means that the
different color components are lying separate in memory.</p>
<p>This can in most cases give a significant speedup, since all bytes of each
plane can be treated the same way. It can also give a speedup because your
filter doesn’t have to work on all planes, if it only modifies one or two of
them.</p>
<p>All images are given a pitch. The pitch is basically what can be described as
“length of a line”. What’s funny is that the pitch does not have to be equal
to the width of the image.</p>
<p>For instance, if you crop something off your image, the only thing that
changes is the width of your image; the pitch and the actual byte-count of a
line remains the same.</p>
<p>The image is then laid out like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">rrrrrrrrrrrrrrrrpppp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rrrrrrrrrrrrrrrrpppp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">rrrrrrrrrrrrrrrrpppp</span></code></p>
<p>Where ‘r’ are the pixels inside the image used, and ‘p’ is the padding
inserted after each line.</p>
<p>In YV12 the Y-plane always has a byte-count that is a multiple of 16, but it
is still possible to have mod2 width images, because the rowsize is different
from the pitch. Similar the UV-planes always have a pitch that is a multiple
of 8.</p>
<p>When you request <code class="docutils literal notranslate"><span class="pre">frame-&gt;GetRowSize(PLANAR_Y)</span></code> you will get the rowsize of
the pixels _inside_ the image. When you request
<code class="docutils literal notranslate"><span class="pre">frame-&gt;GetRowSize(PLANAR_Y_ALIGNED)</span></code> you will ALWAYS get a rowsize that is
a multiple of 16 (multiple of 8 on UV planes).</p>
<p>The reason for you to use pitch to get from one line to another is that pitch
can be even larger than the aligned rowsize - for instance after a crop.</p>
<p>So what you should do is:</p>
<ul class="simple">
<li>Get a rowsize.</li>
<li>For each line in the image:</li>
<li>Process (aligned) rowsize pixels.</li>
<li>Skip to next line, by adding pitch for the current plane.</li>
</ul>
<div class="section" id="yv12-interlacing">
<h4>YV12 interlacing<a class="headerlink" href="#yv12-interlacing" title="Permalink to this headline">¶</a></h4>
<p>YV12 handles interlaced chroma differently than compared to YUY2, since YV12
only contains chroma information for every second line.</p>
<p>To enable interlacing, chroma is stretched across two luma lines in the same
field! That means that luma and chroma aren’t directly mappable to lumaline/2
and lumaline/2+1 as with frame based images.</p>
<p>line 0: Chroma for interlaced luma lines 0+2</p>
<p>line 1: Chroma for interlaced luma lines 1+3</p>
<p>line 2: Chroma for interlaced luma lines 4+6</p>
<p>line 3: Chroma for interlaced luma lines 5+7</p>
<p>…etc!</p>
<p>When viewing the individual lines in each plane this maps to:</p>
<p>Consider the separate planes:</p>
<p>Luma:</p>
<p><code class="docutils literal notranslate"><span class="pre">L1L1L1L1L1L1L1L1L1L1L1L1L1L1L1L1L1L1L1L1L1L1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">L2L2L2L2L2L2L2L2L2L2L2L2L2L2L2L2L2L2L2L2L2L2</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">L3L3L3L3L3L3L3L3L3L3L3L3L3L3L3L3L3L3L3L3L3L3</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">L4L4L4L4L4L4L4L4L4L4L4L4L4L4L4L4L4L4L4L4L4L4</span></code></p>
<p>Chroma that maps to luma plane above:</p>
<p><code class="docutils literal notranslate"><span class="pre">C1C1C1C1C1C1C1C1C1C1C1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">C2C2C2C2C2C2C2C2C2C2C2</span></code></p>
<p>Since luma L1 and L3 are in the same field, the chroma information in C1 is
used for these lines and NOT line L1 + L2 as when the image is frame-based.
C2 is used for lines 2+4 and so on.</p>
<p>This is something that deinterlacers and similar programs need to take into
consideration. Other filters might rely on the use of Separatefields() and
Weave(), to produce framebased images. You can use the
VideoInfo.IsFieldBased() to check your source, and maybe decide to throw an
error, or shift to another processing mode.</p>
<p>If your video is fieldbased your vertical resolution (height) must be
divisible by 4, otherwise AviSynth will not create a new VideoFrame, but will
throw an error.</p>
</div>
</div>
<div class="section" id="links">
<h3>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h3>
<p>See more about <a class="reference internal" href="DataStorageInAviSynth.html"><span class="doc">DataStorageInAviSynth</span></a>.</p>
<p>See a general introduction to <a class="reference internal" href="WorkingWithImages.html"><span class="doc">WorkingWithImages</span></a>.</p>
<hr class="docutils" />
<p>Back to <a class="reference internal" href="FilterSDK.html"><span class="doc">AviSynth FilterSDK</span></a></p>
<p>$Date: 2014/10/27 22:04:54 $</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ColorspaceProperties.html" title="Colorspace properties"
             >next</a> |</li>
        <li class="right" >
          <a href="ChangeFrameSize.html" title="ChangeFrameSize"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>