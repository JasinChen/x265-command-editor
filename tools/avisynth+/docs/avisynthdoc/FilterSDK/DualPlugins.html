

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>DualPlugins &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="EnvInvoke" href="EnvInvoke.html" />
    <link rel="prev" title="Debugging instructions" href="DebuggingAvisynthPlugins.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="EnvInvoke.html" title="EnvInvoke"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="DebuggingAvisynthPlugins.html" title="Debugging instructions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">DualPlugins</a><ul>
<li><a class="reference internal" href="#the-invertneg-example">The InvertNeg example</a><ul>
<li><a class="reference internal" href="#brute-force-solution-one">Brute force solution one</a></li>
<li><a class="reference internal" href="#brute-force-solution-two">Brute force solution two</a></li>
<li><a class="reference internal" href="#xxx">xxx</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-simplesample-example">The SimpleSample example</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="DebuggingAvisynthPlugins.html"
                        title="previous chapter">Debugging instructions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="EnvInvoke.html"
                        title="next chapter">EnvInvoke</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/FilterSDK/DualPlugins.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="dualplugins">
<h1><a class="toc-backref" href="#id1">DualPlugins</a><a class="headerlink" href="#dualplugins" title="Permalink to this headline">¶</a></h1>
<p>There are three ways to make dual plugins. That is 2.6 plugins
(compiled with plugin api v5) that also work with AviSynth 2.5. They
are described here below.</p>
<div class="toctree-wrapper compound">
</div>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#dualplugins" id="id1">DualPlugins</a><ul>
<li><a class="reference internal" href="#the-invertneg-example" id="id2">The InvertNeg example</a><ul>
<li><a class="reference internal" href="#brute-force-solution-one" id="id3">Brute force solution one</a></li>
<li><a class="reference internal" href="#brute-force-solution-two" id="id4">Brute force solution two</a></li>
<li><a class="reference internal" href="#xxx" id="id5">xxx</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-simplesample-example" id="id6">The SimpleSample example</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="the-invertneg-example">
<h2><a class="toc-backref" href="#id2">The InvertNeg example</a><a class="headerlink" href="#the-invertneg-example" title="Permalink to this headline">¶</a></h2>
<p>For InvertNeg it’s straightforward to make it as a dual plugin, since
the code uses the 2.5 feature set. When using the 2.5+ feature set it
becomes more elaborate (and it might not always be possible). See
Simplesample for such an example.</p>
<div class="section" id="brute-force-solution-one">
<h3><a class="toc-backref" href="#id3">Brute force solution one</a><a class="headerlink" href="#brute-force-solution-one" title="Permalink to this headline">¶</a></h3>
<p>This solution doubles all the code. You need to rename avisynth.h (v3)
to avisynth25.h and avisynth.h (v5) to avisynth26.h and add them both
to your project. You also need to add the following two source files to
your project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* InvertNeg25.cpp */

#include &lt;windows.h&gt;
#include &quot;avisynth25.h&quot;

class InvertNeg25 : public GenericVideoFilter {
public:
   InvertNeg25(PClip _child, IScriptEnvironment* env);
   PVideoFrame __stdcall GetFrame(int n, IScriptEnvironment* env);
};

InvertNeg25::InvertNeg25(PClip _child, IScriptEnvironment* env) :
   GenericVideoFilter(_child) {
   if (!vi.IsPlanar() || !vi.IsYUV()) {
      env-&gt;ThrowError(&quot;InvertNeg: planar YUV data only!&quot;);
   }
}

PVideoFrame __stdcall InvertNeg25::GetFrame(int n, IScriptEnvironment* env) {

   PVideoFrame src = child-&gt;GetFrame(n, env);
   PVideoFrame dst = env-&gt;NewVideoFrame(vi);

   const unsigned char* srcp;
   unsigned char* dstp;
   int src_pitch, dst_pitch, row_size, height;
   int p, x, y;

   int planes[] = {PLANAR_Y, PLANAR_V, PLANAR_U};

   for (p=0; p&lt;3; p++) {
      srcp = src-&gt;GetReadPtr(planes[p]);
      dstp = dst-&gt;GetWritePtr(planes[p]);

      src_pitch = src-&gt;GetPitch(planes[p]);
      dst_pitch = dst-&gt;GetPitch(planes[p]);
      row_size = dst-&gt;GetRowSize(planes[p]);
      height = dst-&gt;GetHeight(planes[p]);

      for (y = 0; y &lt; height; y++) {
         for (x = 0; x &lt; row_size; x++) {
            dstp[x] = srcp[x] ^ 255;
         }
         srcp += src_pitch;
         dstp += dst_pitch;
      }
   }
   return dst;
}

AVSValue __cdecl Create_InvertNeg25(AVSValue args, void* user_data, IScriptEnvironment* env) {
   return new InvertNeg25(args[0].AsClip(), env);
}

extern &quot;C&quot; __declspec(dllexport) const char* __stdcall AvisynthPluginInit2(IScriptEnvironment* env) {
   env-&gt;AddFunction(&quot;InvertNeg&quot;, &quot;c&quot;, Create_InvertNeg25, 0);
   return &quot;InvertNeg sample plugin&quot;;
}
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* InvertNeg26.cpp */

#include &lt;windows.h&gt;
#include &quot;avisynth26.h&quot;

class InvertNeg26 : public GenericVideoFilter {
public:
   InvertNeg26(PClip _child, IScriptEnvironment* env);
   PVideoFrame __stdcall GetFrame(int n, IScriptEnvironment* env);
};

InvertNeg26::InvertNeg26(PClip _child, IScriptEnvironment* env) :
   GenericVideoFilter(_child) {
   if (!vi.IsPlanar() || !vi.IsYUV()) {
      env-&gt;ThrowError(&quot;InvertNeg: planar YUV data only!&quot;);
   }
}

PVideoFrame __stdcall InvertNeg26::GetFrame(int n, IScriptEnvironment* env) {

   PVideoFrame src = child-&gt;GetFrame(n, env);
   PVideoFrame dst = env-&gt;NewVideoFrame(vi);

   const unsigned char* srcp;
   unsigned char* dstp;
   int src_pitch, dst_pitch, row_size, height;
   int p, x, y;

   int planes[] = {PLANAR_Y, PLANAR_V, PLANAR_U};

   for (p=0; p&lt;3; p++) {
      srcp = src-&gt;GetReadPtr(planes[p]);
      dstp = dst-&gt;GetWritePtr(planes[p]);

      src_pitch = src-&gt;GetPitch(planes[p]);
      dst_pitch = dst-&gt;GetPitch(planes[p]);
      row_size = dst-&gt;GetRowSize(planes[p]);
      height = dst-&gt;GetHeight(planes[p]);

      for (y = 0; y &lt; height; y++) {
         for (x = 0; x &lt; row_size; x++) {
            dstp[x] = srcp[x] ^ 255;
         }
         srcp += src_pitch;
         dstp += dst_pitch;
      }
   }
   return dst;
}

AVSValue __cdecl Create_InvertNeg26(AVSValue args, void* user_data, IScriptEnvironment* env) {
   return new InvertNeg26(args[0].AsClip(), env);
}

const AVS_Linkage *AVS_linkage = 0;

extern &quot;C&quot; __declspec(dllexport) const char* __stdcall AvisynthPluginInit3(IScriptEnvironment* env, const AVS_Linkage* const vectors) {
   AVS_linkage = vectors;
   env-&gt;AddFunction(&quot;InvertNeg&quot;, &quot;c&quot;, Create_InvertNeg26, 0);
   return &quot;InvertNeg sample plugin&quot;;
}
</pre></div>
</div>
<p>Note that both functions Create_InvertNeg25 and Create_InvertNeg26 are
added in the function table (by AddFunction) as InvertNeg. Which one is
called by your script will be decided by the AvisynthPluginInit2 and
AvisynthPluginInit3 entry points (and thus your AviSynth version).</p>
<p>Compile both files into a DLL named InvertNeg.dll. See
<a class="reference internal" href="CompilingAvisynthPlugins.html"><span class="doc">compiling instructions</span></a>. Now create an
AviSynth script which looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LoadPlugin</span><span class="p">(</span><span class="s2">&quot;d:\path\InvertNeg.dll&quot;</span><span class="p">)</span>
<span class="n">clip</span> <span class="o">=</span> <span class="n">BlankClip</span><span class="p">()</span><span class="o">.</span><span class="n">ConvertToYV12</span><span class="p">()</span>
<span class="k">return</span> <span class="n">clip</span><span class="o">.</span><span class="n">InvertNeg</span><span class="p">()</span>
</pre></div>
</div>
<p>The script should work both for AviSynth 2.5 and 2.6.</p>
</div>
<div class="section" id="brute-force-solution-two">
<h3><a class="toc-backref" href="#id4">Brute force solution two</a><a class="headerlink" href="#brute-force-solution-two" title="Permalink to this headline">¶</a></h3>
<p>To stop having to double your source code you could use the namespace
trick the 2.0 import wrapper uses.</p>
<p>Place all the filter generic code into a separate file,
“InvertNeg.hpp”, and #include it twice. Technically you have two copies
of everything binary, but only a single source code. Note: outside the
namespace you uniquely access object names as avs25::name or
avs26::name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">InvertNeg</span><span class="o">.</span><span class="n">cpp</span> <span class="o">*/</span>

<span class="c1">#include &lt;windows.h&gt;</span>

<span class="n">namespace</span> <span class="n">avs25</span> <span class="p">{</span>
   <span class="c1">#include &quot;avisynth25.h&quot;</span>
   <span class="c1">#include &quot;InvertNeg.hpp&quot;</span>
<span class="p">}</span>

<span class="c1">#undef __AVISYNTH_H__ // name must not be included twice in the inclusions</span>

<span class="n">namespace</span> <span class="n">avs26</span> <span class="p">{</span>
   <span class="c1">#include &quot;avisynth26.h&quot;</span>
   <span class="n">const</span> <span class="n">AVS_Linkage</span> <span class="o">*</span><span class="n">AVS_linkage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="c1">#include &quot;InvertNeg.hpp&quot;</span>
<span class="p">}</span>

<span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="n">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">__stdcall</span> <span class="n">AvisynthPluginInit2</span><span class="p">(</span><span class="n">avs25</span><span class="p">::</span><span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">env</span><span class="o">-&gt;</span><span class="n">AddFunction</span><span class="p">(</span><span class="s2">&quot;InvertNeg&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">avs25</span><span class="p">::</span><span class="n">Create_InvertNeg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
   <span class="k">return</span> <span class="s2">&quot;InvertNeg sample plugin&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="n">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">__stdcall</span> <span class="n">AvisynthPluginInit3</span><span class="p">(</span><span class="n">avs26</span><span class="p">::</span><span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">,</span> <span class="n">const</span> <span class="n">avs26</span><span class="p">::</span><span class="n">AVS_Linkage</span><span class="o">*</span> <span class="n">const</span> <span class="n">vectors</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">avs26</span><span class="p">::</span><span class="n">AVS_linkage</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">;</span>
   <span class="n">env</span><span class="o">-&gt;</span><span class="n">AddFunction</span><span class="p">(</span><span class="s2">&quot;InvertNeg&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="n">avs26</span><span class="p">::</span><span class="n">Create_InvertNeg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
   <span class="k">return</span> <span class="s2">&quot;InvertNeg sample plugin&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* InvertNeg.hpp */

class InvertNeg : public GenericVideoFilter {
public:
   InvertNeg(PClip _child, IScriptEnvironment* env);
   PVideoFrame __stdcall GetFrame(int n, IScriptEnvironment* env);
};

InvertNeg::InvertNeg(PClip _child, IScriptEnvironment* env) :
   GenericVideoFilter(_child) {
   if (!vi.IsPlanar() || !vi.IsYUV()) {
      env-&gt;ThrowError(&quot;InvertNeg: planar YUV data only!&quot;);
   }
}

PVideoFrame __stdcall InvertNeg::GetFrame(int n, IScriptEnvironment* env) {

   PVideoFrame src = child-&gt;GetFrame(n, env);
   PVideoFrame dst = env-&gt;NewVideoFrame(vi);

   const unsigned char* srcp;
   unsigned char* dstp;
   int src_pitch, dst_pitch, row_size, height;
   int p, x, y;

   int planes[] = {PLANAR_Y, PLANAR_V, PLANAR_U};

   for (p=0; p&lt;3; p++) {
      srcp = src-&gt;GetReadPtr(planes[p]);
      dstp = dst-&gt;GetWritePtr(planes[p]);

      src_pitch = src-&gt;GetPitch(planes[p]);
      dst_pitch = dst-&gt;GetPitch(planes[p]);
      row_size = dst-&gt;GetRowSize(planes[p]);
      height = dst-&gt;GetHeight(planes[p]);

      for (y = 0; y &lt; height; y++) {
         for (x = 0; x &lt; row_size; x++) {
            dstp[x] = srcp[x] ^ 255;
         }
         srcp += src_pitch;
         dstp += dst_pitch;
      }
   }
   return dst;
}

AVSValue __cdecl Create_InvertNeg(AVSValue args, void* user_data, IScriptEnvironment* env) {
   return new InvertNeg(args[0].AsClip(), env);
}
</pre></div>
</div>
<p>Compile this file into a DLL named InvertNeg.dll. See
<a class="reference internal" href="CompilingAvisynthPlugins.html"><span class="doc">compiling instructions</span></a>. Now create an AviSynth script which
looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LoadPlugin</span><span class="p">(</span><span class="s2">&quot;d:\path\InvertNeg.dll&quot;</span><span class="p">)</span>
<span class="n">clip</span> <span class="o">=</span> <span class="n">BlankClip</span><span class="p">()</span><span class="o">.</span><span class="n">ConvertToYV12</span><span class="p">()</span>
<span class="k">return</span> <span class="n">clip</span><span class="o">.</span><span class="n">InvertNeg</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="xxx">
<h3><a class="toc-backref" href="#id5">xxx</a><a class="headerlink" href="#xxx" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://forum.doom9.org/showthread.php?p=1641346#post1641346">http://forum.doom9.org/showthread.php?p=1641346#post1641346</a> and
subsequent posts ….</p>
</div>
</div>
<div class="section" id="the-simplesample-example">
<h2><a class="toc-backref" href="#id6">The SimpleSample example</a><a class="headerlink" href="#the-simplesample-example" title="Permalink to this headline">¶</a></h2>
<p>The SimpleSample code uses the 2.5+ feature set, since it uses
GetPlaneWidthSubsampling and GetPlaneHeightSubsampling. These are
functions of <a class="reference internal" href="VideoInfo.html"><span class="doc">VideoInfo</span></a>. One way to get it to work is to add these
functions in avisynth25.h in the <a class="reference internal" href="VideoInfo.html"><span class="doc">VideoInfo</span></a> structure. Note that in
this case they are only used for YV12:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">avisynth25</span><span class="o">.</span><span class="n">h</span> <span class="o">*/</span>

<span class="n">struct</span> <span class="n">VideoInfo</span> <span class="p">{</span>
   <span class="o">...</span>
   <span class="o">//</span> <span class="n">mimics</span> <span class="mf">2.6</span> <span class="n">functionality</span> <span class="k">for</span> <span class="n">YV12</span>
   <span class="nb">int</span> <span class="n">GetPlaneWidthSubsampling</span><span class="p">(</span><span class="nb">int</span> <span class="n">plane</span><span class="p">)</span> <span class="n">const</span> <span class="p">{</span>
      <span class="n">switch</span><span class="p">(</span><span class="n">plane</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">case</span> <span class="n">PLANAR_Y</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">case</span> <span class="n">PLANAR_U</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">case</span> <span class="n">PLANAR_V</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">default</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="nb">int</span> <span class="n">GetPlaneHeightSubsampling</span><span class="p">(</span><span class="nb">int</span> <span class="n">plane</span><span class="p">)</span> <span class="n">const</span> <span class="p">{</span>
      <span class="n">switch</span><span class="p">(</span><span class="n">plane</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">case</span> <span class="n">PLANAR_Y</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">case</span> <span class="n">PLANAR_U</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">case</span> <span class="n">PLANAR_V</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">default</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Now we can place all the filter generic code into a separate file,
“simplesample.hpp”, #include it twice, and access object names as
avs25::name or avs26::name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">simplesample</span><span class="o">.</span><span class="n">cpp</span> <span class="o">*/</span>

<span class="o">/*</span>
    <span class="n">SimpleSample</span> <span class="n">plugin</span> <span class="k">for</span> <span class="n">Avisynth</span> <span class="o">--</span> <span class="n">a</span> <span class="n">simple</span> <span class="n">sample</span>
    <span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">2013</span> <span class="n">Simon</span> <span class="n">Walters</span><span class="p">,</span> <span class="n">Wilbert</span> <span class="n">Dijkhof</span><span class="p">,</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>

    <span class="n">This</span> <span class="n">program</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">;</span> <span class="n">you</span> <span class="n">can</span> <span class="n">redistribute</span> <span class="n">it</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">modify</span>
    <span class="n">it</span> <span class="n">under</span> <span class="n">the</span> <span class="n">terms</span> <span class="n">of</span> <span class="n">the</span> <span class="n">GNU</span> <span class="n">General</span> <span class="n">Public</span> <span class="n">License</span> <span class="k">as</span> <span class="n">published</span> <span class="n">by</span>
    <span class="n">the</span> <span class="n">Free</span> <span class="n">Software</span> <span class="n">Foundation</span><span class="o">.</span>

    <span class="n">This</span> <span class="n">program</span> <span class="ow">is</span> <span class="n">distributed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">hope</span> <span class="n">that</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="n">useful</span><span class="p">,</span>
    <span class="n">but</span> <span class="n">WITHOUT</span> <span class="n">ANY</span> <span class="n">WARRANTY</span><span class="p">;</span> <span class="n">without</span> <span class="n">even</span> <span class="n">the</span> <span class="n">implied</span> <span class="n">warranty</span> <span class="n">of</span>
    <span class="n">MERCHANTABILITY</span> <span class="ow">or</span> <span class="n">FITNESS</span> <span class="n">FOR</span> <span class="n">A</span> <span class="n">PARTICULAR</span> <span class="n">PURPOSE</span><span class="o">.</span> <span class="n">See</span> <span class="n">the</span>
    <span class="n">GNU</span> <span class="n">General</span> <span class="n">Public</span> <span class="n">License</span> <span class="k">for</span> <span class="n">more</span> <span class="n">details</span><span class="o">.</span>

    <span class="n">You</span> <span class="n">should</span> <span class="n">have</span> <span class="n">received</span> <span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">the</span> <span class="n">GNU</span> <span class="n">General</span> <span class="n">Public</span> <span class="n">License</span>
    <span class="n">along</span> <span class="k">with</span> <span class="n">this</span> <span class="n">program</span><span class="p">;</span> <span class="k">if</span> <span class="ow">not</span><span class="p">,</span> <span class="n">write</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Free</span> <span class="n">Software</span>
    <span class="n">Foundation</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span><span class="p">,</span> <span class="mi">675</span> <span class="n">Mass</span> <span class="n">Ave</span><span class="p">,</span> <span class="n">Cambridge</span><span class="p">,</span> <span class="n">MA</span> <span class="mi">02139</span><span class="p">,</span> <span class="n">USA</span><span class="o">.</span>

    <span class="n">The</span> <span class="n">author</span> <span class="n">can</span> <span class="n">be</span> <span class="n">contacted</span> <span class="n">at</span><span class="p">:</span>
    <span class="n">wilbertdijkhof</span> <span class="n">at</span> <span class="n">yahoo</span><span class="o">.</span><span class="n">com</span>

    <span class="n">v2</span><span class="o">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">AviSynth</span> <span class="mf">2.6</span> <span class="n">api</span> <span class="p">(</span><span class="n">based</span> <span class="n">on</span> <span class="n">v1</span><span class="o">.</span><span class="mi">6</span> <span class="n">of</span> <span class="n">Simon</span> <span class="n">Walters</span><span class="p">)</span>
    <span class="n">v2</span><span class="o">.</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Dual</span> <span class="n">plugin</span> <span class="k">for</span> <span class="mf">2.5</span> <span class="ow">and</span> <span class="mf">2.6</span>
<span class="o">*/</span>

<span class="c1">#include &lt;windows.h&gt;</span>

<span class="n">namespace</span> <span class="n">avs25</span> <span class="p">{</span>
    <span class="c1">#include &quot;avisynth25.h&quot;</span>
    <span class="c1">#include &quot;simplesample.hpp&quot;</span>
<span class="p">}</span>

<span class="c1">#undef __AVISYNTH_H__ // name must not be included twice in the inclusions</span>

<span class="n">namespace</span> <span class="n">avs26</span> <span class="p">{</span>
    <span class="c1">#include &quot;avisynth26.h&quot;</span>
    <span class="n">const</span> <span class="n">AVS_Linkage</span> <span class="o">*</span><span class="n">AVS_linkage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">#include &quot;simplesample.hpp&quot;</span>
<span class="p">}</span>

<span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="n">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">__stdcall</span> <span class="n">AvisynthPluginInit2</span><span class="p">(</span><span class="n">avs25</span><span class="p">::</span><span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">env</span><span class="o">-&gt;</span><span class="n">AddFunction</span><span class="p">(</span><span class="s2">&quot;SimpleSample&quot;</span><span class="p">,</span> <span class="s2">&quot;c[size]i&quot;</span><span class="p">,</span> <span class="n">avs25</span><span class="p">::</span><span class="n">Create_SimpleSample</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;SimpleSample plugin&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="n">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">const</span> <span class="n">char</span><span class="o">*</span> <span class="n">__stdcall</span> <span class="n">AvisynthPluginInit3</span><span class="p">(</span><span class="n">avs26</span><span class="p">::</span><span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">,</span> <span class="n">const</span> <span class="n">avs26</span><span class="p">::</span><span class="n">AVS_Linkage</span><span class="o">*</span> <span class="n">const</span> <span class="n">vectors</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">avs26</span><span class="p">::</span><span class="n">AVS_linkage</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">;</span>
    <span class="n">env</span><span class="o">-&gt;</span><span class="n">AddFunction</span><span class="p">(</span><span class="s2">&quot;SimpleSample&quot;</span><span class="p">,</span> <span class="s2">&quot;c[size]i&quot;</span><span class="p">,</span> <span class="n">avs26</span><span class="p">::</span><span class="n">Create_SimpleSample</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;SimpleSample plugin&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">simplesample</span><span class="o">.</span><span class="n">hpp</span> <span class="o">*/</span>

<span class="k">class</span> <span class="nc">SimpleSample</span> <span class="p">:</span> <span class="n">public</span> <span class="n">GenericVideoFilter</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">SquareSize</span><span class="p">;</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">SimpleSample</span><span class="p">(</span><span class="n">PClip</span> <span class="n">_child</span><span class="p">,</span> <span class="nb">int</span> <span class="n">_SquareSize</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">);</span>
    <span class="o">~</span><span class="n">SimpleSample</span><span class="p">();</span>
    <span class="n">PVideoFrame</span> <span class="n">__stdcall</span> <span class="n">GetFrame</span><span class="p">(</span><span class="nb">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">SimpleSample</span><span class="p">::</span><span class="n">SimpleSample</span><span class="p">(</span><span class="n">PClip</span> <span class="n">_child</span><span class="p">,</span> <span class="nb">int</span> <span class="n">_SquareSize</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">GenericVideoFilter</span><span class="p">(</span><span class="n">_child</span><span class="p">),</span> <span class="n">SquareSize</span><span class="p">(</span><span class="n">_SquareSize</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">width</span><span class="o">&lt;</span><span class="n">SquareSize</span> <span class="o">||</span> <span class="n">vi</span><span class="o">.</span><span class="n">height</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">env</span><span class="o">-&gt;</span><span class="n">ThrowError</span><span class="p">(</span><span class="s2">&quot;SimpleSample: square doesn&#39;t fit into the clip!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">SimpleSample</span><span class="p">::</span><span class="o">~</span><span class="n">SimpleSample</span><span class="p">()</span> <span class="p">{}</span>

<span class="n">PVideoFrame</span> <span class="n">__stdcall</span> <span class="n">SimpleSample</span><span class="p">::</span><span class="n">GetFrame</span><span class="p">(</span><span class="nb">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">PVideoFrame</span> <span class="n">src</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">GetFrame</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">env</span><span class="p">);</span>
    <span class="n">env</span><span class="o">-&gt;</span><span class="n">MakeWritable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">src</span><span class="p">);</span>

    <span class="n">unsigned</span> <span class="n">char</span><span class="o">*</span> <span class="n">srcp</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetWritePtr</span><span class="p">();</span>
    <span class="nb">int</span> <span class="n">src_pitch</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetPitch</span><span class="p">();</span>
    <span class="nb">int</span> <span class="n">src_width</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetRowSize</span><span class="p">();</span>
    <span class="nb">int</span> <span class="n">src_height</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetHeight</span><span class="p">();</span>

    <span class="nb">int</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">woffset</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB24</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

        <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">*</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">+=</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
                <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
                <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB32</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

        <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">*</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">+=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
                <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
                <span class="o">*</span><span class="p">(</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="o">/*</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB32</span><span class="p">())</span> <span class="p">{</span> <span class="o">//</span> <span class="n">variant</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">processing</span> <span class="n">a</span> <span class="n">pixel</span> <span class="n">at</span> <span class="n">once</span>
        <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

        <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">*</span><span class="p">((</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span><span class="p">)</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x00FFFFFF</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="o">*/</span>
<span class="o">/*</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsRGB32</span><span class="p">())</span> <span class="p">{</span> <span class="o">//</span> <span class="n">variant</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">processing</span> <span class="n">a</span> <span class="n">pixel</span> <span class="n">at</span> <span class="n">once</span>
        <span class="n">unsigned</span> <span class="nb">int</span><span class="o">*</span> <span class="n">srcp</span> <span class="o">=</span> <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">*</span><span class="p">)</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">GetWritePtr</span><span class="p">();</span>

        <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>

        <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">srcp</span><span class="p">[</span><span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00FFFFFF</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="o">*/</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsYUY2</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

        <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">8</span> <span class="o">-</span> <span class="n">SquareSize</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="n">SquareSize</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">*</span><span class="p">((</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span><span class="p">)</span><span class="n">srcp</span> <span class="o">+</span> <span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="mh">0x80EB80EB</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vi</span><span class="o">.</span><span class="n">IsPlanar</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">vi</span><span class="o">.</span><span class="n">IsYUV</span><span class="p">())</span> <span class="p">{</span>

        <span class="nb">int</span> <span class="n">planes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">PLANAR_Y</span><span class="p">,</span> <span class="n">PLANAR_U</span><span class="p">,</span> <span class="n">PLANAR_V</span><span class="p">};</span>
        <span class="nb">int</span> <span class="n">square_value</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">235</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">};</span>
        <span class="nb">int</span> <span class="n">p</span><span class="p">;</span>
        <span class="nb">int</span> <span class="n">width_sub</span><span class="p">,</span> <span class="n">height_sub</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">p</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">srcp</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetWritePtr</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
            <span class="n">src_pitch</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetPitch</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
            <span class="n">src_width</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetRowSize</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
            <span class="n">src_height</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">GetHeight</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
            <span class="n">width_sub</span> <span class="o">=</span> <span class="n">vi</span><span class="o">.</span><span class="n">GetPlaneWidthSubsampling</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
            <span class="n">height_sub</span> <span class="o">=</span> <span class="n">vi</span><span class="o">.</span><span class="n">GetPlaneHeightSubsampling</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>

            <span class="n">srcp</span> <span class="o">=</span> <span class="n">srcp</span> <span class="o">+</span> <span class="p">(</span><span class="n">src_height</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">height_sub</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_pitch</span><span class="p">;</span>

            <span class="n">woffset</span> <span class="o">=</span> <span class="n">src_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">width_sub</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">h</span><span class="o">&lt;</span><span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">height_sub</span><span class="p">);</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">w</span><span class="o">&lt;</span><span class="p">(</span><span class="n">SquareSize</span><span class="o">&gt;&gt;</span><span class="n">width_sub</span><span class="p">);</span> <span class="n">w</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">srcp</span><span class="p">[</span><span class="n">woffset</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">square_value</span><span class="p">[</span><span class="n">p</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="n">srcp</span> <span class="o">+=</span> <span class="n">src_pitch</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">src</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">AVSValue</span> <span class="n">__cdecl</span> <span class="n">Create_SimpleSample</span><span class="p">(</span><span class="n">AVSValue</span> <span class="n">args</span><span class="p">,</span> <span class="n">void</span><span class="o">*</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">IScriptEnvironment</span><span class="o">*</span> <span class="n">env</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">new</span> <span class="n">SimpleSample</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">AsClip</span><span class="p">(),</span>
                            <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">AsInt</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
                            <span class="n">env</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Compile this file into a DLL named SimpleSample.dll. See
<a class="reference internal" href="CompilingAvisynthPlugins.html"><span class="doc">compiling instructions</span></a>. Now create an Avisynth script which
looks something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LoadPlugin</span><span class="p">(</span><span class="s2">&quot;d:\path\simplesample.dll&quot;</span><span class="p">)</span>
<span class="n">Colorbars</span><span class="p">()</span><span class="o">.</span><span class="n">Trim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ConvertToYV12</span><span class="p">()</span>
<span class="c1"># ConvertToYV411() # requires AviSynth 2.6</span>
<span class="n">SimpleSample</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
<p>Back to <a class="reference internal" href="FilterSDK.html"><span class="doc">AviSynth FilterSDK</span></a></p>
<p>$Date: 2014/10/27 22:04:54 $</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="EnvInvoke.html" title="EnvInvoke"
             >next</a> |</li>
        <li class="right" >
          <a href="DebuggingAvisynthPlugins.html" title="Debugging instructions"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>