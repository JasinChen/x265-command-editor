

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Sampling &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Scripting reference" href="../script_ref/script_ref.html" />
    <link rel="prev" title="Luminance levels" href="luminance_levels.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../script_ref/script_ref.html" title="Scripting reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="luminance_levels.html" title="Luminance levels"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Sampling</a><ul>
<li><a class="reference internal" href="#color-format-conversions-and-the-chroma-upsampling-error">Color format conversions and the Chroma Upsampling Error</a><ul>
<li><a class="reference internal" href="#chroma-upsampling-error-or-cue">Chroma Upsampling Error (or CUE)</a></li>
<li><a class="reference internal" href="#correcting-video-having-the-chroma-upsampling-error">Correcting video having the Chroma Upsampling Error</a></li>
</ul>
</li>
<li><a class="reference internal" href="#theoretical-aspects">Theoretical Aspects</a><ul>
<li><a class="reference internal" href="#the-color-formats-rgb-yuy2-and-yv12">The color formats: RGB, YUY2 and YV12</a><ul>
<li><a class="reference internal" href="#yuv-4-4-4-color-format">YUV 4:4:4 color format</a></li>
<li><a class="reference internal" href="#yuy2-color-format">YUY2 color format</a></li>
<li><a class="reference internal" href="#yv12-color-format">YV12 color format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subsampling">Subsampling</a><ul>
<li><a class="reference internal" href="#rgb-yuy2-conversion">RGB -&gt; YUY2 conversion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upsampling">Upsampling</a><ul>
<li><a class="reference internal" href="#yuy2-conversion-rgb">YUY2 conversion -&gt; RGB</a></li>
<li><a class="reference internal" href="#yv12-interlaced-conversion-yuy2">YV12 interlaced conversion -&gt; YUY2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#format-specific-sampling">Format-specific sampling</a><ul>
<li><a class="reference internal" href="#mpeg-1-versus-mpeg-2-sampling">MPEG-1 versus MPEG-2 sampling</a></li>
<li><a class="reference internal" href="#dv-sampling">DV sampling</a></li>
<li><a class="reference internal" href="#id2">References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interlaced-chroma-problem-or-icp">4:2:0 Interlaced Chroma Problem (or ICP)</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="luminance_levels.html"
                        title="previous chapter">Luminance levels</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../script_ref/script_ref.html"
                        title="next chapter">Scripting reference</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/advancedtopics/sampling.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="sampling">
<h1><a class="toc-backref" href="#id7">Sampling</a><a class="headerlink" href="#sampling" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#sampling" id="id7">Sampling</a><ul>
<li><a class="reference internal" href="#color-format-conversions-and-the-chroma-upsampling-error" id="id8">Color format conversions and the Chroma Upsampling Error</a><ul>
<li><a class="reference internal" href="#chroma-upsampling-error-or-cue" id="id9">Chroma Upsampling Error (or CUE)</a></li>
<li><a class="reference internal" href="#correcting-video-having-the-chroma-upsampling-error" id="id10">Correcting video having the Chroma Upsampling Error</a></li>
</ul>
</li>
<li><a class="reference internal" href="#theoretical-aspects" id="id11">Theoretical Aspects</a><ul>
<li><a class="reference internal" href="#the-color-formats-rgb-yuy2-and-yv12" id="id12">The color formats: RGB, YUY2 and YV12</a><ul>
<li><a class="reference internal" href="#yuv-4-4-4-color-format" id="id13">YUV 4:4:4 color format</a></li>
<li><a class="reference internal" href="#yuy2-color-format" id="id14">YUY2 color format</a></li>
<li><a class="reference internal" href="#yv12-color-format" id="id15">YV12 color format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subsampling" id="id16">Subsampling</a><ul>
<li><a class="reference internal" href="#rgb-yuy2-conversion" id="id17">RGB -&gt; YUY2 conversion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upsampling" id="id18">Upsampling</a><ul>
<li><a class="reference internal" href="#yuy2-conversion-rgb" id="id19">YUY2 conversion -&gt; RGB</a></li>
<li><a class="reference internal" href="#yv12-interlaced-conversion-yuy2" id="id20">YV12 interlaced conversion -&gt; YUY2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references" id="id21">References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#format-specific-sampling" id="id22">Format-specific sampling</a><ul>
<li><a class="reference internal" href="#mpeg-1-versus-mpeg-2-sampling" id="id23">MPEG-1 versus MPEG-2 sampling</a></li>
<li><a class="reference internal" href="#dv-sampling" id="id24">DV sampling</a></li>
<li><a class="reference internal" href="#id2" id="id25">References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interlaced-chroma-problem-or-icp" id="id26">4:2:0 Interlaced Chroma Problem (or ICP)</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="color-format-conversions-and-the-chroma-upsampling-error">
<h2><a class="toc-backref" href="#id8">Color format conversions and the Chroma Upsampling Error</a><a class="headerlink" href="#color-format-conversions-and-the-chroma-upsampling-error" title="Permalink to this headline">¶</a></h2>
<p>The following figures show errors, which are examples of <strong>the Chroma
Upsampling Error</strong>, called this way because the video is upsampled
incorrectly (interlaced YV12 upsampled as progressive or vice versa). As a
result, you will often see gaps on the top and bottom of colored objects and
“ghost” lines floating above or below the objects.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="../../_images/badchroma.jpg" class="first last" src="../../_images/badchroma.jpg" />
</td>
</tr>
<tr class="row-even"><td>figure 1a: example of interlaced source (YV12) being upsampled as progressive video (YUY2) (from <a class="reference external" href="http://zenaria.com/gfx/">http://zenaria.com/gfx/</a>)</td>
</tr>
<tr class="row-odd"><td><img alt="../../_images/goodchroma.jpg" class="first last" src="../../_images/goodchroma.jpg" />
</td>
</tr>
<tr class="row-even"><td>figure 1b: the same image with correct chroma upsampling (from <a class="reference external" href="http://zenaria.com/gfx/">http://zenaria.com/gfx/</a>)</td>
</tr>
<tr class="row-odd"><td><img alt="../../_images/badchroma2.jpg" class="first last" src="../../_images/badchroma2.jpg" />
</td>
</tr>
<tr class="row-even"><td>figure 2a: example of progressive source (YV12) being upsampled as interlaced video (YUY2)</td>
</tr>
<tr class="row-odd"><td><img alt="../../_images/goodchroma2.jpg" class="first last" src="../../_images/goodchroma2.jpg" />
</td>
</tr>
<tr class="row-even"><td>figure 2b: the same image with correct chroma upsampling</td>
</tr>
</tbody>
</table>
<p>In this section, it will be shown what causes it, and how to fix it. Where
fixing mean making it less visible, because it’s not possible to correct it
completely.</p>
<div class="line-block">
<div class="line">References:</div>
<div class="line">[<a class="reference external" href="http://www.hometheaterhifi.com/volume_8_2/dvd-benchmark-special-report-chroma-bug-4-2001.html">The Chroma Upsampling Error</a>]</div>
<div class="line">[<a class="reference external" href="http://members.aol.com/ajaynejr/vidbug2.htm">The Chroma Upsampling Error - Television and Video Advice</a>]</div>
</div>
<div class="section" id="chroma-upsampling-error-or-cue">
<h3><a class="toc-backref" href="#id9">Chroma Upsampling Error (or CUE)</a><a class="headerlink" href="#chroma-upsampling-error-or-cue" title="Permalink to this headline">¶</a></h3>
<p>As previously stated, the Chroma Upsampling Error occurs when you convert
from (trully) interlaced YV12 to mostly any other format and the converter
thinks the video is progressive. Or, the other way around, if material is
progressive (or interlaced encoded as progressive), and upsampled as
interlaced. This is however not as bad as the other way around.</p>
<p>When VDub previews your video, it will need to convert it to RGB. Since
AviSynth delivers YV12, it asks the codec (for example XviD or DivX) to
convert YV12 to RGB. The codec however ALWAYS upsamples progressively. Hence
you will get artifacts in VDub preview on interlaced YV12 material. This is
however not present in the YV12 video (or in the resulting encoding). To
confirm this, let AviSynth do the conversion by adding
ConvertToRGB(interlaced=true) at the end of your script.</p>
</div>
<div class="section" id="correcting-video-having-the-chroma-upsampling-error">
<h3><a class="toc-backref" href="#id10">Correcting video having the Chroma Upsampling Error</a><a class="headerlink" href="#correcting-video-having-the-chroma-upsampling-error" title="Permalink to this headline">¶</a></h3>
<p>You will have to blur the chroma in some way (leaving the luma intact).</p>
<p>For example (using tomsmocomp.dll):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AviSource</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">MergeChroma</span><span class="p">(</span><span class="n">TomsMoComp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="theoretical-aspects">
<h2><a class="toc-backref" href="#id11">Theoretical Aspects</a><a class="headerlink" href="#theoretical-aspects" title="Permalink to this headline">¶</a></h2>
<p>In this section, the chroma placement will be explained, how this is related
to subsampling (RGB -&gt; YUY2 -&gt; YV12) and how the upsampling is done in
AviSynth.</p>
<p>It should also explain in detail why the CUE occurs. To summarize the latter,
the problem is that there is a difference between YV12 progressive and YV12
interlaced, because the chroma is shared vertically between neighboring
pixels.</p>
<p>See also <a class="reference external" href="http://forum.doom9.org/showthread.php?s=&amp;threadid=52151&amp;highlight=upsampling">http://forum.doom9.org/showthread.php?s=&amp;threadid=52151&amp;highlight=upsampling</a>.</p>
<div class="section" id="the-color-formats-rgb-yuy2-and-yv12">
<h3><a class="toc-backref" href="#id12">The color formats: RGB, YUY2 and YV12</a><a class="headerlink" href="#the-color-formats-rgb-yuy2-and-yv12" title="Permalink to this headline">¶</a></h3>
<p>In order to be able to understand how YV12 &lt;-&gt; YUY2 sampling works and why it
matters whether your source is interlaced or progressive, the YV12/YUY2 color
formats will be discussed first. It’s not important here how they are stored
in your memory. Information about that can be found in <a class="reference internal" href="#references"><span class="std std-ref">Section 2.4 References</span></a>.</p>
<div class="section" id="yuv-4-4-4-color-format">
<h4><a class="toc-backref" href="#id13">YUV 4:4:4 color format</a><a class="headerlink" href="#yuv-4-4-4-color-format" title="Permalink to this headline">¶</a></h4>
<p>The term 4:4:4 denotes that for every four samples of the luminance (Y),
there are four samples each of U and V. Thus each pixel has a luminance value
(Y), a U value (blue difference sample or Cb) and a V value (red difference
sample or Cr). Note, “C” is just a chroma sample (UV-sample).</p>
<p>The layout of a 4:4:4 encoded image looks as follows</p>
<table border="1" class="docutils">
<colgroup>
<col width="62%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>YC YC YC YC</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>YC YC YC YC</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>YC YC YC YC</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>YC YC YC YC</td>
<td>line 4</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="yuy2-color-format">
<h4><a class="toc-backref" href="#id14">YUY2 color format</a><a class="headerlink" href="#yuy2-color-format" title="Permalink to this headline">¶</a></h4>
<p>YUY2 (or YUYV) is a 4:2:2 format. The term 4:2:2 denotes that for every four
samples of the luminance (Y), there are two samples each of U and V, giving
less chrominance (color) bandwidth in relation to luminance. So for each
pixel, it is horizontally sharing UV (chroma) with a neighboring pixel.</p>
<p>The layout of a 4:2:2 encoded image looks as follows</p>
<table border="1" class="docutils">
<colgroup>
<col width="62%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>YC Y YC Y</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>YC Y YC Y</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>YC Y YC Y</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>YC Y YC Y</td>
<td>line 4</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="yv12-color-format">
<h4><a class="toc-backref" href="#id15">YV12 color format</a><a class="headerlink" href="#yv12-color-format" title="Permalink to this headline">¶</a></h4>
<p>For the YV12 color format, there’s a difference between progressive and
interlaced. The cause is that chroma values are also shared vertically
between two neighboring lines.</p>
<p>YV12 is a 4:2:0 format. The term 4:2:0 denotes that for every four samples
(two horizontal and two vertical) of the luminance (Y), there is one sample
each of U and V, giving less chrominance (color) bandwidth in relation to
luminance.</p>
<p><strong>YV12 progressive</strong></p>
<p>For each pixel, it is horizontally sharing UV (chroma or C) with a
neighboring pixel and vertically sharing UV with the neighboring line (thus
line 1 with line 2, line 3 with 4, etc).</p>
<p>The layout of a progressive 4:2:0 encoded image looks as follows (MPEG 2
scheme - see below)</p>
<table border="1" class="docutils">
<colgroup>
<col width="62%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 1</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 2</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 3</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 4</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
</tr>
</tbody>
</table>
<p><strong>YV12 interlaced</strong></p>
<p>For each pixel, it is horizontally sharing UV (chroma or C) with a
neighboring pixel and vertically sharing UV with the next to neighboring line
(thus line 1t with line 3t, line 2b with 4b, etc).</p>
<p>The layout of a interlaced 4:2:0 encoded image looks as follows (MPEG 2
scheme - see below)</p>
<table border="1" class="docutils">
<colgroup>
<col width="59%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 1t</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 2b</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 3t</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 4b</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
</tr>
</tbody>
</table>
<p>or</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="31%" />
<col width="31%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">field 1</th>
<th class="head">field 2</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td>line 1t</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td>line 2b</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td>line 3t</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td>line 4b</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="subsampling">
<h3><a class="toc-backref" href="#id16">Subsampling</a><a class="headerlink" href="#subsampling" title="Permalink to this headline">¶</a></h3>
<p>Subsampling is used to reduce the storage and broadcast bandwidth
requirements for digital video. This is effective for a !YCbCr signal because
the human eye is more sensitive for changes in black and white than for
changes in color. So drastically reducing the color info shows very little
difference. YUY2 and YV12 are examples of reduced color formats.</p>
<div class="section" id="rgb-yuy2-conversion">
<h4><a class="toc-backref" href="#id17">RGB -&gt; YUY2 conversion</a><a class="headerlink" href="#rgb-yuy2-conversion" title="Permalink to this headline">¶</a></h4>
<div class="line-block">
<div class="line">More about RGB -&gt; YUV color conversions can be found here: <a class="reference internal" href="color_conversions.html"><span class="doc">ColorConversions</span></a>.</div>
<div class="line">Recall the layout of a 4:4:4 encoded image</div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="68%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>YC1 YC2 YC3 YC4</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>YC1 YC2 YC3 YC4</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>YC1 YC2 YC3 YC4</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>YC1 YC2 YC3 YC4</td>
<td>line 4</td>
</tr>
</tbody>
</table>
<p>In AviSynth, the default mode is using a 1-2-1 kernel to interpolate chroma,
that is</p>
<div class="line-block">
<div class="line">C1x = (C1+C1+C1+C2)/4 (C1 is used three times, since this is the border)</div>
<div class="line">C3x = (C2+C3+C3+C4)/4</div>
<div class="line">C5x = (C4+C5+C5+C6)/4</div>
</div>
<p>The 4:2:2 encoded image becomes</p>
<table border="1" class="docutils">
<colgroup>
<col width="70%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y1C1x Y2 Y3C3x Y4</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>Y1C1x Y2 Y3C3x Y4</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>Y1C1x Y2 Y3C3x Y4</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>Y1C1x Y2 Y3C3x Y4</td>
<td>line 4</td>
</tr>
</tbody>
</table>
<p>The other mode <a class="reference internal" href="../corefilters/convert.html"><span class="doc">ConvertBackToYUY2</span></a> uses chroma from the left pixel, thus</p>
<table border="1" class="docutils">
<colgroup>
<col width="70%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y1C1 Y2 Y3C3 Y4</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>Y1C1 Y2 Y3C3 Y4</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>Y1C1 Y2 Y3C3 Y4</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>Y1C1 Y2 Y3C3 Y4</td>
<td>line 4</td>
</tr>
</tbody>
</table>
<p><em>Note (as with the layout of other formats) the position of the chroma
values, represent the WEIGHT result of the subsampling.</em></p>
<p><strong>YUY2 -&gt; YV12 interlaced conversion</strong></p>
<p>Recall the layout of a interlaced 4:2:0 encoded image, but with the weights
included:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="21%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
<th class="head">weights</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 1t</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.75)*1t + (0.25)*3t</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 2b</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 3t</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.25)*2b + (0.75)*4b</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 4b</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>or</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="18%" />
<col width="18%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">field 1</th>
<th class="head">field 2</th>
<th class="head">line</th>
<th class="head">weights</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 1t</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.75)*1t + (0.25)*3t</div>
</div>
</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 2b</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 3t</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>C___C__</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.25)*2b + (0.75)*4b</div>
</div>
</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 4b</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p><em>Note (as with the layout of other formats) the position of the chroma
values, represent the WEIGHT as a result of the subsampling.</em></p>
<p>Thus the chroma is stretched across two luma lines in the same field!</p>
<p><strong>YUY2 -&gt; YV12 progressive conversion</strong></p>
<p>Recall the layout of a 4:2:0 encoded image</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="20%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
<th class="head">weights</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 1</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.5)*1 + (0.5)*2</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 2</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 3</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.5)*3 + (0.5)*4</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 4</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p><em>Note (as with the layout of other formats) the position of the chroma
values, represent the WEIGHT result of the subsampling.</em></p>
<p>Thus the chroma is stretched across two luma lines in the same frame!</p>
</div>
</div>
<div class="section" id="upsampling">
<h3><a class="toc-backref" href="#id18">Upsampling</a><a class="headerlink" href="#upsampling" title="Permalink to this headline">¶</a></h3>
<div class="section" id="yuy2-conversion-rgb">
<h4><a class="toc-backref" href="#id19">YUY2 conversion -&gt; RGB</a><a class="headerlink" href="#yuy2-conversion-rgb" title="Permalink to this headline">¶</a></h4>
<p>Recall the layout of a 4:2:2 encoded image</p>
<table border="1" class="docutils">
<colgroup>
<col width="70%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y1C1 Y2 Y3C3 Y4</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>Y1C1 Y2 Y3C3 Y4</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>Y1C1 Y2 Y3C3 Y4</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>Y1C1 Y2 Y3C3 Y4</td>
<td>line 4</td>
</tr>
</tbody>
</table>
<p>The C++ and the ASM code use different sampling methods.</p>
<p>For the C++ code ConvertToRGB uses the same chroma for two RGB pixels using
left point upsampling. Thus the 4:4:4 encoded image becomes</p>
<table border="1" class="docutils">
<colgroup>
<col width="72%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y1C1 Y2C1 Y3C3 Y4C3</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>Y1C1 Y2C1 Y3C3 Y4C3</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>Y1C1 Y2C1 Y3C3 Y4C3</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>Y1C1 Y2C1 Y3C3 Y4C3</td>
<td>line 4</td>
</tr>
</tbody>
</table>
<p>For the ASM code ConvertToRGB the missing chroma samples are interpolated
(using a [1 1] kernel), that is</p>
<div class="line-block">
<div class="line">C2x = (C1+C3)/2</div>
<div class="line">C4x = (C3+C5)/2</div>
</div>
<p>and the existing chroma samples are just copied.</p>
<p>The 4:4:4 encoded image becomes</p>
<table border="1" class="docutils">
<colgroup>
<col width="74%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y1C1 Y2C2x Y3C3 Y4C4x</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>Y1C1 Y2C2x Y3C3 Y4C4x</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>Y1C1 Y2C2x Y3C3 Y4C4x</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>Y1C1 Y2C2x Y3C3 Y4C4x</td>
<td>line 4</td>
</tr>
</tbody>
</table>
<p>The ASM code is the one which is actually used in AviSynth.</p>
</div>
<div class="section" id="yv12-interlaced-conversion-yuy2">
<h4><a class="toc-backref" href="#id20">YV12 interlaced conversion -&gt; YUY2</a><a class="headerlink" href="#yv12-interlaced-conversion-yuy2" title="Permalink to this headline">¶</a></h4>
<p>In AviSynth, the missing chroma samples are interpolated as follows</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="21%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
<th class="head">weights</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 1t</td>
<td>chroma of YV12_lines 1t</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 2b</td>
<td>chroma of YV12_lines 4b</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 3t</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*1t + (0.25)*5t</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 4b</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*4b + (0.25)*8b</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 5t</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.25)*1t + (0.75)*5t</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 6b</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.25)*4b + (0.75)*8b</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 7t</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*5t + (0.25)*9t</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 8b</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*8b + (0.25)*12b</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>or</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">field 1</th>
<th class="head">field 2</th>
<th class="head">line</th>
<th class="head">weights</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 1t</td>
<td>chroma of YV12_lines 1t</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 2b</td>
<td>chroma of YV12_lines 4b</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 3t</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*1t + (0.25)*5t</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 4b</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*4b + (0.25)*8b</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 5t</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.25)*1t + (0.75)*5t</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 6b</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.25)*4b + (0.75)*8b</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 7t</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*5t + (0.25)*9t</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 8b</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*8b + (0.25)*12b</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>This implementation results in a <a class="reference external" href="http://forum.doom9.org/showthread.php?p=1294886#post1294886">chroma shift</a>. AviSynth uses a different
interpolation as the one suggested by the mpeg2 specs (perhaps due to speed
issues). The latter is</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">field 1</th>
<th class="head">field 2</th>
<th class="head">line</th>
<th class="head">weights</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 1t</td>
<td>chroma of YV12_lines 1t</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 2b</td>
<td>chroma of YV12_lines 4b</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 3t</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(5/8)*1t + (3/8)*5t</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 4b</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(7/8)*4b + (1/8)*8b</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 5t</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(1/8)*1t + (7/8)*5t</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 6b</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(3/8)*4b + (5/8)*8b</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td>&#160;</td>
<td rowspan="2">line 7t</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(5/8)*5t + (3/8)*9t</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td>Y_Y_Y_Y</td>
<td rowspan="2">line 8b</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(7/8)*8b + (1/8)*12b</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p><strong>YV12 progressive conversion -&gt; YUY2</strong></p>
<p>The missing chroma samples are interpolated as follows</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="20%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
<th class="head">weights</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 1</td>
<td>chroma of YV12_lines 1</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 2</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*1 + (0.25)*3</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 3</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.25)*1 + (0.75)*3</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 4</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*3 + (0.25)*5</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 5</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.25)*3 + (0.75)*5</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 6</td>
<td><div class="first last line-block">
<div class="line">chroma of YV12_lines</div>
<div class="line">(0.75)*5 + (0.25)*7</div>
</div>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="references">
<span id="id1"></span><h3><a class="toc-backref" href="#id21">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line"><a class="reference internal" href="../FilterSDK/ColorSpaces.html"><span class="doc">ColorSpaces</span></a></div>
<div class="line">[<a class="reference external" href="http://www.quantel.com/domisphere/infopool.nsf/HTML/dfb444?OpenDocument">4:4:4</a>] sampling</div>
<div class="line">[<a class="reference external" href="http://www.quantel.com/domisphere/infopool.nsf/HTML/dfb422?OpenDocument">4:2:2</a>] sampling</div>
<div class="line">[<a class="reference external" href="http://www.quantel.com/domisphere/infopool.nsf/HTML/dfb420?OpenDocument">4:2:0</a>] sampling</div>
<div class="line">[<a class="reference external" href="http://www.hometheaterhifi.com/volume_8_2/dvd-benchmark-special-report-chroma-bug-4-2001.html">Chroma Upsampling</a>]</div>
<div class="line">[<a class="reference external" href="http://www.mir.com/DMG/chroma.html">Chroma Subsampling Standards</a>]</div>
</div>
</div>
</div>
<div class="section" id="format-specific-sampling">
<h2><a class="toc-backref" href="#id22">Format-specific sampling</a><a class="headerlink" href="#format-specific-sampling" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mpeg-1-versus-mpeg-2-sampling">
<h3><a class="toc-backref" href="#id23">MPEG-1 versus MPEG-2 sampling</a><a class="headerlink" href="#mpeg-1-versus-mpeg-2-sampling" title="Permalink to this headline">¶</a></h3>
<p>There are two common variants of 4:2:0 sampling. One of these is used in
MPEG-2 (and CCIR-601) video, and the other is used in MPEG-1. <strong>The MPEG-2
scheme is how AviSynth samples 4:2:0 video</strong>, because it completely avoids
horizontal resampling in 4:2:0 &lt;-&gt; 4:2:2 conversions.</p>
<p>The layout of a progressive MPEG-1 4:2:0 encoded image</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="20%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
<th class="head">weights</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 1</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>_C__C_</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.5)*1 + (0.5)*2</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 2</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 3</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>_C__C_</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.5)*3 + (0.5)*4</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 4</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>The layout of a MPEG-2 4:2:0 encoded image</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="20%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">frame</th>
<th class="head">line</th>
<th class="head">weights</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 1</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.5)*1 + (0.5)*2</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 2</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 3</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>C___C__</td>
<td><div class="first last line-block">
<div class="line">chroma of YUY2_lines</div>
<div class="line">(0.5)*3 + (0.5)*4</div>
</div>
</td>
</tr>
<tr class="row-even"><td>Y_Y_Y_Y</td>
<td rowspan="2">line 4</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dv-sampling">
<h3><a class="toc-backref" href="#id24">DV sampling</a><a class="headerlink" href="#dv-sampling" title="Permalink to this headline">¶</a></h3>
<p>For completeness, we will mention DV sampling. DV is 4:2:0 (PAL) and 4:1:1
(NTSC). Note, that the sample positioning of the former is different from the
4:2:0 chroma in MPEG-1/MPEG-2!</p>
<p>The layout of a 4:2:0 encoded image (field-based)</p>
<table border="1" class="docutils">
<colgroup>
<col width="72%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">field</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>YV Y YV Y YV Y YV Y</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>YU Y YU Y YU Y YU Y</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>YV Y YV Y YV Y YV Y</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>YU Y YU Y YU Y YU Y</td>
<td>line 4</td>
</tr>
</tbody>
</table>
<p>The layout of a 4:1:1 encoded image (field-based)</p>
<table border="1" class="docutils">
<colgroup>
<col width="70%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">field</th>
<th class="head">line</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>YC Y Y Y YC Y Y Y</td>
<td>line 1</td>
</tr>
<tr class="row-odd"><td>YC Y Y Y YC Y Y Y</td>
<td>line 2</td>
</tr>
<tr class="row-even"><td>YC Y Y Y YC Y Y Y</td>
<td>line 3</td>
</tr>
<tr class="row-odd"><td>YC Y Y Y YC Y Y Y</td>
<td>line 4</td>
</tr>
</tbody>
</table>
<p>Some comments about this formats:</p>
<ul class="simple">
<li>4:1:1 is supported natively in AviSynth v2.6.</li>
<li>DV decoders all output YUY2 or RGB (with the exception of ffdshow when YV12
is enabled).</li>
<li>When outputting YUY2/RGB (NTSC), the MainConcept codec duplicates the
chroma samples instead of interpolating. The [<a class="reference external" href="http://mywebpages.comcast.net/trbarry/downloads.htm">ReInterpolate411 plugin</a>] can
be used to correct for this, resulting in better quality.</li>
</ul>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id25">References</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">[<a class="reference external" href="http://http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnwmt/html/YUVFormats.asp">MSDN: YUV sampling</a>] Describes the most common YUV sampling techniques.</div>
<div class="line">[<a class="reference external" href="http://www.adamwilt.com/pix-sampling.html">DV sampling</a>]</div>
</div>
</div>
</div>
<div class="section" id="interlaced-chroma-problem-or-icp">
<h2><a class="toc-backref" href="#id26">4:2:0 Interlaced Chroma Problem (or ICP)</a><a class="headerlink" href="#interlaced-chroma-problem-or-icp" title="Permalink to this headline">¶</a></h2>
<p>In general interlaced content will have static parts. If it is upsampled
correctly using interlaced upsampling, it will still have <em>chroma problems on
diagonal edges of bright-colored objects in static parts of a frame</em>. The
reason is that “When the two fields are put back together later by a
deinterlacer (or by your eye and brain, if you watch it on an interlaced TV),
the relatively smooth gradations and contours of each field are broken up by
a slightly different set of gradations and contours from the other field.”
(quote from first reference). This is called <strong>the Interlaced Chroma
Problem</strong>. The “solution” is a motion-adaptive upsampler, but such an
AviSynth/VDub filter which attempts to do this doesn’t exist yet.</p>
<div class="line-block">
<div class="line">References:</div>
<div class="line">[<a class="reference external" href="http://www.hometheaterhifi.com/volume_8_2/dvd-benchmark-special-report-chroma-bug-4-2001.html">The 4:2:0 Interlaced Chroma Problem</a>]</div>
<div class="line">[<a class="reference external" href="http://members.aol.com/ajaynejr/vidbug2.htm">The 4:2:0 Interlaced Chroma Problem - Television and Video Advice</a>]</div>
</div>
<p>$Date: 2010/06/05 14:47:46 $</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../script_ref/script_ref.html" title="Scripting reference"
             >next</a> |</li>
        <li class="right" >
          <a href="luminance_levels.html" title="Luminance levels"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>