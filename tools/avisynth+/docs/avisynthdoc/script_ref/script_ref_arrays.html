

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Arrays &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Block statements" href="script_ref_block_statements.html" />
    <link rel="prev" title="Scripting reference" href="script_ref.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="script_ref_block_statements.html" title="Block statements"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="script_ref.html" title="Scripting reference"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="script_ref.html"
                        title="previous chapter">Scripting reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="script_ref_block_statements.html"
                        title="next chapter">Block statements</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/script_ref/script_ref_arrays.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="arrays">
<h1>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">¶</a></h1>
<p>As everybody using Avisynth knows, arrays are not supported natively by the
scripting language.</p>
<p>However, a library named [<a class="reference external" href="http://avslib.sourceforge.net/">AVSLib</a>] exists that provides a functional
interface for creating and manipulating arrays. Coupled with Avisynth’s OOP
style for calling functions, one can treat arrays as objects with methods,
which is a familiar and easy to understand and code scripting concept.</p>
<p>Therefore, two preparatory steps are needed before being able to create and
manipulate process arrays into your script:</p>
<ul class="simple">
<li>[<a class="reference external" href="http://sourceforge.net/projects/avslib/">Download</a>] and install the most current version of AVSLib into
your system.</li>
<li>Import the needed AVSLib files in your script as follows (see the
instructions inside the library’s documentation to fill-in the gaps):</li>
<li>AVSLib 1.1.x versions: Enter <code class="docutils literal notranslate"><span class="pre">LoadPackage(&quot;avslib&quot;,</span> <span class="pre">&quot;array&quot;)</span></code> to
load the array implementation files, or <code class="docutils literal notranslate"><span class="pre">LoadLibrary(&quot;avslib&quot;,</span>
<span class="pre">CONFIG_AVSLIB_FULL)</span></code> to load entire AVSLib.</li>
<li>AVSLib 1.0.x versions: Enter an appropriate <a class="reference internal" href="../corefilters/import.html"><span class="doc">Import</span></a> ({path to AVSLib
header}) statement as the first line of your script.</li>
</ul>
<p>Now you are ready to create your first array! In order to provide an almost
real case example let’s assume the following (which are commonplace in many
situations) about the script you want to create:</p>
<ul class="simple">
<li>The script selects a distinct range of frames from each video clip.</li>
<li>Some of the input clips may have different size, fps, audio and/or
colorspace; thus they need to be converted.</li>
<li>Some of the filtering parameters are distinct for each clip.</li>
</ul>
<p>Having done that, let’s proceed to the actual code:</p>
<p>First, we create the array; ..1.., ..2.., etc. are actual filename strings.
Clip loading is made by <a class="reference internal" href="../corefilters/avisource.html"><span class="doc">AviSource</span></a> in the example but
<a class="reference internal" href="../corefilters/directshowsource.html"><span class="doc">DirectShowSource</span></a> may also be specified.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inp</span> <span class="o">=</span> <span class="n">ArrayCreate</span><span class="p">(</span> \
    <span class="n">AviSource</span><span class="p">(</span><span class="o">..</span><span class="mf">1.</span><span class="o">.</span><span class="p">),</span> \
    <span class="n">AviSource</span><span class="p">(</span><span class="o">..</span><span class="mf">2.</span><span class="o">.</span><span class="p">),</span> \
    <span class="o">...</span> \
    <span class="n">AviSource</span><span class="p">(</span><span class="o">..</span><span class="n">n</span><span class="o">..</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<p>Then we convert to same fps, audio, colorspace and size by using
<a class="reference internal" href="../corefilters/fps.html"><span class="doc">AssumeFPS</span></a>, <a class="reference internal" href="../corefilters/convertaudio.html"><span class="doc">ConvertAudioTo16bit</span></a>,
<a class="reference internal" href="../corefilters/convert.html"><span class="doc">ConvertToYV12</span></a> and <a class="reference internal" href="../corefilters/resize.html"><span class="doc">BilinearResize</span></a>
respectively (or any resizer that you find fit). We use OOP + chaining to
make compact expressions.</p>
<p>Note that since Avisynth does not provide a way for in-place variable
modification we must reassign to an array variable after each array operation
(usually the same).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inp</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">ArrayOpFunc</span><span class="p">(</span><span class="s2">&quot;AssumeFPS&quot;</span><span class="p">,</span> <span class="s2">&quot;24&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ArrayOpFunc</span><span class="p">(</span><span class="s2">&quot;ConvertAudioTo16bit&quot;</span> \
    <span class="p">)</span><span class="o">.</span><span class="n">ArrayOpFunc</span><span class="p">(</span><span class="s2">&quot;ConvertToYV12&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ArrayOpFunc</span><span class="p">(</span><span class="s2">&quot;BilinearResize&quot;</span><span class="p">,</span> <span class="s2">&quot;640,480&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To perform trimming we will use arrays of other types also. Below <em>ts</em> stands
for first frame to trim, <em>te</em> for last; each number corresponds to a clip in
<em>inp</em> variable.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">ArrayCreate</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span> <span class="c1"># n numbers in total</span>
<span class="n">te</span> <span class="o">=</span> <span class="n">ArrayCreate</span><span class="p">(</span><span class="mi">8540</span><span class="p">,</span> <span class="mi">7834</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mi">5712</span><span class="p">)</span> <span class="c1"># n numbers in total</span>
</pre></div>
</div>
<p>We also need a counter to make things easier; we will use ArrayRange to
create an array of 0,1,2,…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cnt</span> <span class="o">=</span> <span class="n">ArrayRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inp</span><span class="o">.</span><span class="n">ArrayLen</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition we must define a user function that will accept <em>inp</em>, <em>ts</em>, <em>te</em>
and <em>cnt</em> and do the trimming.</p>
<p>Since ArrayOpArrayFunc only accepts two arrays for per-element processing, it
is easier to pass ‘inp’ and <em>cnt</em> as array elements and <em>ts</em>, <em>te</em> as entire
arrays.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Function</span> <span class="n">MyTrim</span><span class="p">(</span><span class="n">clip</span> <span class="n">c</span><span class="p">,</span> <span class="nb">int</span> <span class="n">count</span><span class="p">,</span> <span class="n">string</span> <span class="n">fs</span><span class="p">,</span> <span class="n">string</span> <span class="n">fe</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">Trim</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">ArrayGet</span><span class="p">(</span><span class="n">count</span><span class="p">),</span> <span class="n">fe</span><span class="o">.</span><span class="n">ArrayGet</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we are ready to do the trim (line below).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inp</span> <span class="o">=</span> <span class="n">ArrayOpArrayFunc</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">cnt</span><span class="p">,</span> <span class="s2">&quot;MyTrim&quot;</span><span class="p">,</span> <span class="n">StrQuote</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="n">StrQuote</span><span class="p">(</span><span class="n">te</span><span class="p">))</span>
</pre></div>
</div>
<p>We will finish the processing with a final tweak on brightness with different
settings on each clip and on hue with same settings for all clips.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bright</span> <span class="o">=</span> <span class="n">ArrayCreate</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">)</span> <span class="c1"># n numbers in total</span>

<span class="n">Function</span> <span class="n">MyTweak</span><span class="p">(</span><span class="n">clip</span> <span class="n">c</span><span class="p">,</span> <span class="nb">float</span> <span class="n">br</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">Tweak</span><span class="p">(</span><span class="n">bright</span><span class="o">=</span><span class="n">br</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="mf">12.3</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">inp</span> <span class="o">=</span> <span class="n">ArrayOpArrayFunc</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">bright</span><span class="p">,</span> <span class="s2">&quot;MyTweak&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And now we are ready to combine the results and return them as script’s
output. We will use <a class="reference external" href="http://avisynth.org/mediawiki/Dissolve">Dissolve</a> for a smoother transition.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">inp</span><span class="o">.</span><span class="n">ArraySum</span><span class="p">(</span><span class="n">sum_func</span><span class="o">=</span><span class="s2">&quot;Dissolve&quot;</span><span class="p">,</span> <span class="n">sum_args</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is it; the n input clips have been converted to a common video and audio
format, trimmed and tweaked with individual settings and returned as a single
video stream with only 11 lines of code (excluding comments).</p>
<p>Other types of array processing are also possible (slicing ie operation on a
subset of elements, joining, multiplexing, etc.) but these are topics to be
discussed in other pages. Those that are interested can browse the <a class="reference external" href="http://avslib.sourceforge.net/">AVSLib</a>
documentation. One can also take a closer look at the <a class="reference external" href="http://avslib.sourceforge.net/examples/index.html">examples section</a>
of the AVSLib documentation.</p>
<hr class="docutils" />
<p>Back to <a class="reference internal" href="script_ref.html"><span class="doc">scripting reference</span></a>.</p>
<p>$Date: 2008/04/20 19:07:33 $</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="script_ref_block_statements.html" title="Block statements"
             >next</a> |</li>
        <li class="right" >
          <a href="script_ref.html" title="Scripting reference"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>