

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AviSynth Syntax - Control structures &#8212; AviSynth+ 3.4 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="../../_static/AvsiDoc.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="AviSynth Syntax - Internal functions" href="syntax_internal_functions.html" />
    <link rel="prev" title="AviSynth - Colors" href="syntax_colors.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="syntax_internal_functions.html" title="AviSynth Syntax - Internal functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="syntax_colors.html" title="AviSynth - Colors"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/DocIcon-Large.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">AviSynth Syntax - Control structures</a><ul>
<li><a class="reference internal" href="#the-try-catch-statement">The <code class="docutils literal notranslate"><span class="pre">try..catch</span></code> statement</a></li>
<li><a class="reference internal" href="#other-control-structures-in-the-broad-sense">Other control structures (in the broad sense)</a><ul>
<li><a class="reference internal" href="#example-1-create-a-function-that-returns-a-n-times-repeated-character-sequence">Example 1: Create a function that returns a n-times repeated character sequence</a></li>
<li><a class="reference internal" href="#example-2-create-a-function-that-selects-frames-of-a-clip-in-arbitrary-intervals">Example 2: Create a function that selects frames of a clip in arbitrary intervals</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="syntax_colors.html"
                        title="previous chapter">AviSynth - Colors</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="syntax_internal_functions.html"
                        title="next chapter">AviSynth Syntax - Internal functions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/avisynthdoc/syntax/syntax_control_structures.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="avisynth-syntax-control-structures">
<h1><a class="toc-backref" href="#id1">AviSynth Syntax - Control structures</a><a class="headerlink" href="#avisynth-syntax-control-structures" title="Permalink to this headline">¶</a></h1>
<p>In the strict sense, <a class="reference internal" href="syntax.html"><span class="doc">AviSynth Syntax</span></a> provides only one control structure
(actually two, the other being the conditional <a class="reference internal" href="syntax_operators.html"><span class="doc">operator</span></a>, <code class="docutils literal notranslate"><span class="pre">?:</span></code>, presented
elsewhere), the <code class="docutils literal notranslate"><span class="pre">try..catch</span></code> statement.</p>
<div class="toctree-wrapper compound">
</div>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#avisynth-syntax-control-structures" id="id1">AviSynth Syntax - Control structures</a><ul>
<li><a class="reference internal" href="#the-try-catch-statement" id="id2">The <code class="docutils literal notranslate"><span class="pre">try..catch</span></code> statement</a></li>
<li><a class="reference internal" href="#other-control-structures-in-the-broad-sense" id="id3">Other control structures (in the broad sense)</a><ul>
<li><a class="reference internal" href="#example-1-create-a-function-that-returns-a-n-times-repeated-character-sequence" id="id4">Example 1: Create a function that returns a n-times repeated character sequence</a></li>
<li><a class="reference internal" href="#example-2-create-a-function-that-selects-frames-of-a-clip-in-arbitrary-intervals" id="id5">Example 2: Create a function that selects frames of a clip in arbitrary intervals</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="the-try-catch-statement">
<h2><a class="toc-backref" href="#id2">The <code class="docutils literal notranslate"><span class="pre">try..catch</span></code> statement</a><a class="headerlink" href="#the-try-catch-statement" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">try..catch</span></code> statement permits the execution of code that <strong>may</strong>
generate a run-time error and the handling of the error, if it actually
arises.</p>
<p>The full syntax of the <code class="docutils literal notranslate"><span class="pre">try..catch</span></code> statement is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="n">statements</span>
    <span class="o">...</span>
<span class="p">}</span>
<span class="n">catch</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="n">statements</span>
    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">err_msg</span></code> string in the <code class="docutils literal notranslate"><span class="pre">catch</span></code> block contains the text generated by
AviSynth when the error inside the <code class="docutils literal notranslate"><span class="pre">try</span></code> block was encountered. This text
is the same that would appear in the familiar MessageBox that shows up when a
fatal script error occures.</p>
<p>You can query the text (it is a normal string <a class="reference internal" href="syntax_script_variables.html"><span class="doc">variable</span></a>) to find specific
substrings inside that indicate the error that has been encountered. This is
a technique that can produce many useful results (for an example, see
<a class="reference external" href="http://forum.doom9.org/showthread.php?t=66627">here</a>).</p>
</div>
<div class="section" id="other-control-structures-in-the-broad-sense">
<h2><a class="toc-backref" href="#id3">Other control structures (in the broad sense)</a><a class="headerlink" href="#other-control-structures-in-the-broad-sense" title="Permalink to this headline">¶</a></h2>
<p>In the broad sense, there are many elements inside <a class="reference internal" href="syntax.html"><span class="doc">AviSynth Syntax</span></a> that
although not control structures by themselves, together they allow the
creation of language constructs equivalent to a control structure. Those
constructs in turn allow the performance of complex programming tasks.</p>
<p>The elements under consideration are the following:</p>
<ol class="arabic simple">
<li>The <code class="docutils literal notranslate"><span class="pre">Eval()</span></code> statement that allows execution of arbitrary script
language statements (and its cousin <code class="docutils literal notranslate"><span class="pre">Apply</span></code> that simplifies calling
functions by name).</li>
<li>Multiline strings and in particular multiline strings surrounded by
triple double quotes (the <code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;</span></code> sequence of chars), since they allow to
write string literals inside them naturally, as one would do in a normal
AviSynth script.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Import()</span></code> statement that allows execution of arbitrary
scripts, which can return a value (not necessarily a clip; a script can
return a value of any type, which can be assigned to a <a class="reference internal" href="syntax_script_variables.html"><span class="doc">variable</span></a> of the
calling script).</li>
<li>Recursion (the ability to create recursive functions).</li>
<li>Control functions, in particular Assert, Select, Default, NOP.</li>
</ol>
<p>The first three allow one to create simple <a class="reference internal" href="../script_ref/script_ref_block_statements.html"><span class="doc">Block statements</span></a>, such as
branching blocks (the analogous of the <code class="docutils literal notranslate"><span class="pre">if..elseif..else</span></code> control structure
commonly encountered in programming and scripting languages). A basic example
is presented below (see the link above for more):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># define different filtering based on this flag
heavy_filtering = true
AviSource(&quot;c:\sources\mysource.avi&quot;)
# assign result of Eval() to a variable to preserve the value of the
last special variable
dummy = flag ? Eval(&quot;&quot;&quot;
    Levels(0, 1.2, 255, 20, 235)
    stext = &quot;heavily filtered&quot;
    Spline36Resize(720, 400)
&quot;&quot;&quot;) : Eval(&quot;&quot;&quot;
    stext = &quot;lightly filtered&quot;
    BicubicResize(720, 400)
&quot;&quot;&quot;
AddBorders(0, 40, 0, 40)
Subtitle(stext)
</pre></div>
</div>
<p>The fourth is the general tool provided by the <a class="reference internal" href="syntax.html"><span class="doc">AviSynth syntax</span></a> for operating on
collections and calculating expressions of any complexity. It is also,
currently, <strong>the only</strong> tool.</p>
<p>This does not mean that there is something that you can’t do inside the
AviSynth script language; in fact recursion together with assignment can
achieve everything an imperative language with looping constructs can do. It
just does it in a way that most people without special programming skills are
not familiar, since functional programming is not a major ICT course but
rather a specialised topic.</p>
<p>The fifth are more or less necessary tools inside the above constructs for
controlling input, setting values and facilitating proper execution of the
construct.</p>
<p>Lets look at some examples of recursion, to grasp the general pattern that
one must follow to master it for its purposes.</p>
<div class="section" id="example-1-create-a-function-that-returns-a-n-times-repeated-character-sequence">
<h3><a class="toc-backref" href="#id4">Example 1: Create a function that returns a n-times repeated character sequence</a><a class="headerlink" href="#example-1-create-a-function-that-returns-a-n-times-repeated-character-sequence" title="Permalink to this headline">¶</a></h3>
<p>We will use an existing implementation, from <a class="reference external" href="http://avslib.sourceforge.net/">AVSLib</a> as our example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Function StrFill(string s, int count, bool &quot;strict&quot;) {
    strict = Default(strict, true)
    Assert((strict ? count &gt;= 0 : true), &quot;StrFill: &#39;count&#39;
    cannot be negative&quot;)
    return count &gt; 0 ? s + StrFill(s, count - 1) : &quot;&quot;
}
</pre></div>
</div>
<p>The recursion is the call that the function makes to itself at the <code class="docutils literal notranslate"><span class="pre">return</span></code>
statement. In order to be done properly, the sequence of recursive calls must
eventually end to a single return value. Thus a recursive function’s return
statement will always use the conditional <a class="reference internal" href="syntax_operators.html"><span class="doc">operator</span></a>, <code class="docutils literal notranslate"><span class="pre">?:</span></code>.</p>
<p>This is all that is about recursion, the other two lines (where the fifth
element, control functions are used) are simply for ensuring that proper
arguments are passed in. The “strict” argument is just and add-on for using
the functions in case where it should quietly (without throwing an error)
return an empty string.</p>
</div>
<div class="section" id="example-2-create-a-function-that-selects-frames-of-a-clip-in-arbitrary-intervals">
<h3><a class="toc-backref" href="#id5">Example 2: Create a function that selects frames of a clip in arbitrary intervals</a><a class="headerlink" href="#example-2-create-a-function-that-selects-frames-of-a-clip-in-arbitrary-intervals" title="Permalink to this headline">¶</a></h3>
<p>Filters like <a class="reference internal" href="../corefilters/selectevery.html"><span class="doc">SelectEvery</span></a> allow the efficient selection of arbitrary sets
of frames. They require though that each set of frames has a constant frame
separation with its successor and predecessor set (in other words, the sets
are periodic on frame number). In order to select frames with varying
separation (that is non-periodic) we have to resort to script functions that
use recursion.</p>
<p>The function below is a generic frame selection filter, which in order to
select arbitrary frames uses a user-defined function (the <code class="docutils literal notranslate"><span class="pre">func</span></code> argument
must contain its name) that maps the interval <code class="docutils literal notranslate"><span class="pre">[s_idx..e_idx)</span></code> to the set
of frames that will be selected. <code class="docutils literal notranslate"><span class="pre">func</span></code> must accept a single integer as
argument and return the corresponding mapped frame number.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Function FSelectEvery(clip c, string func, int s_idx, int e_idx) {
    Assert(s_idx &gt;= 0, &quot;FSelectEvery: start frame index
    (s_idx) is negative&quot;)
    f = Apply(func, s_idx)
    return (s_idx &lt; e_idx &amp;&amp; f &gt;= 0 &amp;&amp; f &lt; c.Framecount) \
       ? c.Trim(f, -1) + FSelectEvery(c, func, s_idx + 1,
       e_idx) \
       : c.BlankClip(length=0)
}
</pre></div>
</div>
<p>The recursive step (first conditional branch in the <code class="docutils literal notranslate"><span class="pre">return</span></code> statement) is
again an expression that involves the function as a subpart. This is not
necessary in the general case (depending on the specific task, it could also
be just the function call) but it is the most usual case when building
complex constructs.</p>
<p><code class="docutils literal notranslate"><span class="pre">Apply</span></code> calls the user function to calculate the frame number (a more
robust implementation would enclose this call in a <code class="docutils literal notranslate"><span class="pre">try...catch</span></code> block). If
the frame number is within the clip’s frames then the associated frame is
appended to the result else recursion ends.</p>
<p>The following example will clarify the design:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># my custom selector (x^2)</span>
<span class="n">Function</span> <span class="n">CalcFrame</span><span class="p">(</span><span class="nb">int</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Int</span><span class="p">(</span><span class="n">Pow</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">}</span>

<span class="n">AviSource</span><span class="p">(</span><span class="s2">&quot;my_200_frames.avi&quot;</span><span class="p">)</span>
<span class="c1"># select up to 20 frames, mapped by CalcFrame</span>
<span class="c1"># in this case: 0, 1, 4, 9, 16, 25, 36, 49, 64, 81, 100, 121, 144,</span>
<span class="mi">169</span><span class="p">,</span> <span class="mi">196</span>
<span class="n">FSelectEvery</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="s2">&quot;CalcFrame&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>$Date: 2008/04/21 20:31:23 $</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="syntax_internal_functions.html" title="AviSynth Syntax - Internal functions"
             >next</a> |</li>
        <li class="right" >
          <a href="syntax_colors.html" title="AviSynth - Colors"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">AviSynth+ 3.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Invisible Tree</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2000-2019, AviSynth and AviSynth+ contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>